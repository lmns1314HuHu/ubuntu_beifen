_.Module.define({require:["props/widget/propsData"],path:"pcommon/component/BubbleFactory",requires:[],sub:{_curPropId:0,_bubbleDefaultProp:null,_list:[{id:0,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/nobubble.png",name:"\u4E0D\u4F7F\u7528\u6C14\u6CE1",type:0},{id:1010034,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang.jpg",name:"\u4ECA\u5929\u957F\u8FD9\u6837",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010033,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing.jpg",name:"\u6211\u60F3\u9759\u9759",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010032,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan.jpg",name:"\u7136\u5E76\u5375",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010031,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jiji.jpg",name:"\u6324\u6324",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jiji_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jiji_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/jiji_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010030,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qianpai.jpg",name:"\u524D\u6392",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qianpai_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qianpai_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qianpai_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010020,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi.jpg",name:"\u5C0F\u718A\u5F00\u5B66",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_03.png",topHeight:"11",bottomHeight:"108"}},{id:1010019,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/piaoliupings.jpg",name:"\u6F02\u6D41\u74F6",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_3.png",topHeight:"110",bottomHeight:"34"}},{id:1010016,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/panpasis.jpg",name:"\u6F58\u5E15\u65AF\u4E4B\u9E70",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/panpasi_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/panpasi_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/panpasi_3.png",topHeight:"54",bottomHeight:"91"}},{id:1010015,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/riermans.jpg",name:"\u65E5\u8033\u66FC\u6218\u8F66",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/rierman_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/rierman_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/rierman_3.png",topHeight:"50",bottomHeight:"65"}},{id:1010014,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfeis.jpg",name:"\u8349\u957F\u83BA\u98DE",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_3.png",topHeight:"61",bottomHeight:"58"}},{id:1010012,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xingnis.jpg",name:"\u6765\u81EA\u661F\u661F\u7684\u4F60",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xingni_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xingni_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xingni_3.png",topHeight:"35",bottomHeight:"67"}},{id:1010011,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qingrens.jpg",name:"\u4E18\u6BD4\u7279",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qingren_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qingren_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/qingren_3.png",topHeight:"60",bottomHeight:"66"}},{id:1010010,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/chunjies.jpg",name:"\u6B22\u5EA6\u6625\u8282",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/chunjie_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/chunjie_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/chunjie_3.png",topHeight:"35",bottomHeight:"68"}},{id:1010007,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/yuandans.jpg",name:"\u559C\u5E86\u5143\u65E6",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/yuandan_01.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/yuandan_02.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/yuandan_03.png",topHeight:"24",bottomHeight:"56"}},{id:1010006,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shengdans.jpg",name:"\u5FEB\u4E50\u5723\u8BDE",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shengdian_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shengdan_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shengdan_3.png",topHeight:"26",bottomHeight:"72"}},{id:1010005,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/zhangyus.jpg",name:"\u6CE1\u6FA1\u7AE0\u9C7C",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_3.png",topHeight:"66",bottomHeight:"70"}},{id:1010004,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/tuhaos.jpg",name:"\u94BB\u77F3\u571F\u8C6A\u91D1",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/tuhao_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/tuhao_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/tuhao_3.png",topHeight:"37",bottomHeight:"42"}},{id:1010003,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/dashus.jpg",name:"\u5FAE\u7B11\u5927\u53D4",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shushu_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shushu_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/shushu_3.png",topHeight:"31",bottomHeight:"55"}},{id:1010002,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/dazuiguais.jpg",name:"\u5927\u5634\u602A",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_3.png",topHeight:"78",bottomHeight:"34"}},{id:1010001,smallPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xiaolus.jpg",name:"\u773A\u671B\u5C0F\u9E7F",type:1,background:{topPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_1.png",middlePic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_2.png",bottomPic:"http://tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_3.png",topHeight:"45",bottomHeight:"55"}}],initial:function(){PageData.user&&PageData.user.mParr_props&&PageData.user.mParr_props.default_bubble&&PageData.user.mParr_props.default_bubble.client&&PageData.user.mParr_props.default_bubble.client.props_id&&(this._bubbleDefaultProp=PageData.user.mParr_props.default_bubble.client,this._curPropId=this._bubbleDefaultProp.props_id)},loadUserPropsData:function(t){var b=this,i=this.require("props/widget/propsData"),o=i.getInstance();o.getProps(101,function(i){b._userPropList=i,b._list=$.map(b._list,function(t){return t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=b.hasUserPower(t.id),t.loseTime=t.isBuy?b.hasNearLosePower(t.id):0,t}),t()})},hasUserPower:function(t){if(0==t)return!0;var b=this.get(t),i=this._userPropList[b.id]||{},o=1*new Date,c=(parseInt(1e3*i.end_time)-o)/864e5;return 0==b.type?!0:i&&c>0?!0:!1},hasNearLosePower:function(t){var b=this._userPropList[t||0]||{},i=1*new Date,o=(parseInt(1e3*b.end_time)-i)/864e5;return b&&o>0&&2>o?parseInt(o+1):0},get:function(t){return _.filter(this._list,function(b){return b.id==t})[0]},getRandom:function(){var t=parseInt(Math.random()*this._list.length);return 0==this._list[t].id||this._list[t].id==this._curPropId?this.getRandom():this._list[t].id},getAll:function(){return this._list},setPropId:function(t){this._curPropId=this.get(t)?t:this._curPropId,PageData.user.bubble_id=this._curPropId},getPropId:function(){return this._curPropId},getCurrent:function(){if(this._bubbleDefaultProp.props_id===this._curPropId){var t=$.extend(this.get(this._curPropId),this._bubbleDefaultProp);t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=1e3*t.end_time>new Date;var b=(parseInt(1e3*t.end_time)-1e3*new Date)/864e5;return t.loseTime=t.isBuy?b>0&&2>b?b+1:0:0,t}return this.get(this._curPropId)}}});!function(e){var t;_.Module.use("ueglibs/widget/Ban",[],function(e){t=e}),$(".j_richPosterAppealLink").live("click",function(){$.stats.track("posterAppealLink","uegCount","bawuAppeal","click")});var r={POST_AUTHORIZED:"authorized",POST_LOGIN_NEEDED:"\u672C\u5427\u53D1\u8D34\uFF0C\u8BF7\u5148 <a href=\"#\" onclick=\"_.Module.use('pcommon/widget/LoginDialog', ['', 'editor']);return false;\">\u767B\u5F55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6CE8\u518C</a>&nbsp;",POST_USERNAME_NEEDED:"\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148<a href=\"#\" onclick=\"TbCom.process('User','buildUnameFrame','\u586B\u5199\u7528\u6237\u540D',' ');return false;\">\u586B\u5199\u7528\u6237\u540D</a>",POST_BLOCKED:t.render("richPoster"),POST_LEVEL_LIMITED:'\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8<a href="http://tieba.baidu.com/f/like/level?kw=#{forum_name}&ie=utf-8" target="_blank">4\u7EA7\u5934\u8854</a><br />\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34',POST_BAWU_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34",POST_LAW_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34",POST_QUALIFICATIONS_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34",POST_THREAD_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u4E3B\u9898\u8D34",POST_REPLY_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u56DE\u590D\u8D34",POST_THREAD_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u4E3B\u9898\u8D34",POST_REPLY_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u56DE\u590D\u8D34",POST_PAD_LIMITED:"\u5207\u6362\u6210pad\u7248\u8D34\u5427\uFF0C\u7545\u4EAB\u66F4\u987A\u7545\u7684\u53D1\u8D34\u4F53\u9A8C\uFF01",POST_ONLY_LOUZHU_CAN_REPLY:"\u4E0D\u597D\u610F\u601D\u54E6\uFF0C\u672C\u697C\u76EE\u524D\u53EA\u5141\u8BB8\u697C\u4E3B\u56DE\u590D\u54E6~<br/>\u5982\u679C\u4F60\u6709\u76F8\u540C\u6216\u5176\u4ED6\u7684\u95EE\u9898\uFF0C\u8BF7\u5728\u672C\u5427\u53D1\u8D34\u53CD\u9988\u54E6~",context:null,authorities:null,loadContext:function(e){this.context=e},loadContextFromPageData:function(e){var t="frs"==e.product,r="pb"==e.product;this.context={forum:{id:e.forum.forum_id,name:e.forum.forum_name,nameEncoded:e.forum.name_url},user:{id:e.user.user_id,name:e.user.user_name,level:e.user.level_id?e.user.level_id:e.user.balv.level_id,isFavorForum:t?e.user.balv.is_like:PageData.user.is_like,isLogin:!!e.user.is_login,isBlocked:t?!!e.user.is_block:!!PageData.user.forbidden.isForbid,isBlack:t?!!e.user.balv.is_black:!!e.user.is_black,noUsername:!!e.user.no_un,canPost:t?e.user.power.post:PageData.power.can_post,canVote:t?e.user.power.vote_creater:!1,forbidFlag:e.forum.forbid_flag,signNumber:e.user.is_login?e.forum.sign_in_info&&e.forum.sign_in_info.user_info?e.forum.sign_in_info.user_info.c_sign_num:0:0,superboy:e.user.superboy,props:e.user.Parr_props,gameSignature:e.user.game_attr},product:e.product,floor:0,tbs:e.tbs,isPad:e.is_ipad,page:e.page,isBlessForum:e.userfortune&&e.userfortune.has_fortune_bag},r&&(this.context.thread={id:e.thread.thread_id,thread_type:PageData.thread.thread_type},this.context.floor=e.thread.reply_num)},loadAuthorities:function(e){$.browser.msie&&$.browser.version<8&&(e.long_editor=!1,e.float_editor=!1),this.authorities=e},getContext:function(){return this.context},getAuthorities:function(){return this.authorities},isPostAllowed:function(){return this._validatePostAuthority()==this.POST_AUTHORIZED},getPostRejectedMessage:function(){var e=this._validatePostAuthority();return e!=this.POST_AUTHORIZED?$.tb.format(e,$.extend({forum_name:this.context.forum.name},this.context)):null},_validatePostAuthority:function(){var e=this.context.user;return e.isLogin?e.noUsername?this.POST_USERNAME_NEEDED:e.isBlocked?this.POST_BLOCKED:e.canPost?"pb"==PageData.product&&PageData.feedback&&0!=PageData.feedback&&PageData.user.user_name!=PageData.thread.author?this.FORBID_FLAG_MAP[11]:this.context.isPad?this.POST_PAD_LIMITED:this.POST_AUTHORIZED:this.FORBID_FLAG_MAP[e.forbidFlag]:this.POST_LOGIN_NEEDED}};r.FORBID_FLAG_MAP={1:r.POST_LOGIN_NEEDED,2:r.POST_QUALIFICATIONS_LIMITED,3:r.POST_LEVEL_LIMITED,4:r.POST_BAWU_LIMITED,5:r.POST_LAW_LIMITED,7:r.POST_REPLY_ONLY,8:r.POST_THREAD_ONLY,9:r.POST_REPLY_LEVEL_LIMITED,10:r.POST_THREAD_LEVEL_LIMITED,11:r.POST_ONLY_LOUZHU_CAN_REPLY},e.PosterContext=r}(window);_.Module.define({path:"pfrs/widget/LocalPosterCategory",sub:{initial:function(){this.initEvt()},initEvt:function(){$(document).delegate(".j_poster_cate_radio","change",$.proxy(function(){var t=$(".j_poster_cate_radio:checked").val();this._select(t)},this)).on("local_cate_cates_changed",$.proxy(function(t,e){this._select(e,!0),$(".j_cur_scid").val(e)},this))},_select:function(t,e){e&&$(".j_poster_cate_radio[value="+t+"]").tbprop("checked",!0),$(".j_class_id").val(t)}}});_.Module.define({path:"pcommon/widget/RichPoster",requires:["pcommon/widget/PostService","pcommon/widget/WordLimit","pcommon/widget/PostPrefix","pcommon/widget/PostSignature","pcommon/widget/MousePwd","encourage/widget/PostGuessingNew","pcommon/component/BubbleFactory","pcommon/widget/payMember","pcommon/widget/LoginDialog","puser/widget/user_api"],sub:{_payMemberTpl:'<a href="javascript:;" class="j-placeholder-pay-member" style="color:#999; text-decoration:none;margin-left: 80px;margin-top:12px;display:block;">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C</a>',initial:function(t){var e=$("#tb_rich_poster_container").hide();this.$container=e,this.$root=$($("#rich_ueditor_tpl").html()),this.$window=$(window),this.$editorContainer=this.$root.find(".ueditor_container"),this.prefix=t.prefix,e.append(this.$root),this.isFrs="frs"===PosterContext.getContext().product,this.isPb="pb"===PosterContext.getContext().product,this.isQinglang=t.isQinglang,this.QinglangData=t.QinglangData,this.hideHolder=0,t.keywordBubbleConf&&(this.keywordBubbleConf=t.keywordBubbleConf,this.keywordBubbleConf.beginTime=1e3*+this.keywordBubbleConf.beginTime,this.keywordBubbleConf.endTime=1e3*+this.keywordBubbleConf.endTime),this.initPostService(),this.isFrs&&(this.$title=this.$root.find(".j_title"),this.$classId=this.$root.find(".j_class_id"),this.initTitle());var o=PosterContext.getContext().page;if(this.isPb&&"pb_bright"!==o&&this.$root.addClass("compat_rich_poster"),this.initDraft(),this.initEditor(),this.initEvent(),this.initPlaceholder(),PosterContext.getAuthorities().long_editor&&this.initFloatingToolbar(),this.initMousePwd(),this.initSignature(),e.show(),PosterContext.context.user.isLogin&&!PosterContext.isPostAllowed())$.browser.msie&&6==$.browser.version||this.editor.ready(function(){this.disable()}),this.showWarning(PosterContext.getPostRejectedMessage()),this.toggleSubmitButton(!0),this.$title&&this.$title.tbprop("disabled",!0);else{if(this.isFrs){var i="",s=window.PageData.user;if(this.QinglangData&&this.QinglangData.title)i=this.QinglangData.title;else{var n=s.mParr_props&&s.mParr_props.level&&this.isBeMember()?"\u4EB2\u7231\u7684\u4F1A\u5458\uFF0C\u8BF7\u8F93\u5165\u60A8\u7684\u6807\u9898":"\u8BF7\u586B\u5199\u6807\u9898";i=n}this.requireInstanceAsync("pcommon/widget/Placeholder",[this.$title,i,{color:"#bfbfbf"}])}this.editor.ready(function(){this.restoreDraft()})}PageUnit.load("rich_poster_show_music_recommend"),this.initPostReward(),this.isFrs&&PosterContext.getContext().user.isLogin&&this.showOfflineCard()},showOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(this.offline_card=this.requireInstance("pcommon/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":0,left:34,top:122},arrow_pos:{left:25},wrap:$("#tb_rich_poster"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}),this.offline_card.showCard())},initPostService:function(){var t=this,e="",o=!(!window.history||!window.history.pushState);this.postService=this.requireInstance("pcommon/widget/PostService"),this.postService.success(function(i,s){t.editor.setContent(""),t.editor.clearDraft();var n=2e3,r=t.postData&&t.postData.content;t.isKeywordBubble(r)?(t.showKeywordBubble(),n=3e3):t.showPostSuccess(s),PosterContext.getContext().isBlessForum&&t.setBlessCookie();var a=Math.ceil(10*Math.random());a>8&&($.stats.track("pb-list\u6700\u4E0B_F90","PC\u7AEF\u5F69\u7968pb\u53D1\u5E16\u8BD5\u9A8C","pb","view",{obj_url:"http://tb1.bdstatic.com/tb/cms/com/icon/F90_icon.gif"}),$.tb.Storage.set("pb_show_ad_f90","Y",(new Date).getTime()+8e3)),"pb"===PageData.product?PageData.pager.total_page===PageData.pager.cur_page?($.stats.sendRequest("fr=tb0_forum&st_mod=pb_post&st_type=pb_post_refresh"),setTimeout(function(){e=$.tb.location.getHref().replace($.tb.location.getProtocol()+"//"+$.tb.location.getHost(),""),-1!==e.indexOf("#")&&(e=e.slice(0,e.indexOf("#"))),-1===e.search(/pn=(\d+)/)&&(e+=-1===e.search(/\?/)?"?pn=1":"&pn=1"),o?window.refreshPage(e):window.refreshPage("",+e.match(/pn=(\d+)/)[1])},500)):$.stats.sendRequest("fr=tb0_forum&st_mod=pb_post&st_type=pb_post_noaction"):setTimeout(function(){t.refresh()},t.isIntelligentCategory()?1500:500),setTimeout(function(){t.isKeywordBubble(r)?t.removeKeywordBubble():$(".tb_poster_info").remove(),t.togglePostState(!1);var e=$(window).scrollTop();e>0&&(window.scrollTo(0,1),setTimeout(function(){window.scrollTo(0,0)},0))},n)}).complete(function(){t.togglePostState(!1)})},initEvent:function(){var t=this;this.$submit=this.$root.find(".j_submit").click(function(e){if(e.preventDefault(),!t.$submit.is(".ui_btn_disable")){var o=t.$root.find(".j-beyond-push-checkbox");t.isFrs&&o.length&&o.tbattr("checked")?t.validateContent()&&t.showBeyondTypeDialog():t.post()}}),this.$root.on("keyup",function(e){if(e.ctrlKey&&13==e.keyCode){var o=t.$root.find(".j-beyond-push-checkbox");t.isFrs&&o.length&&o.tbattr("checked")?t.validateContent()&&t.showBeyondTypeDialog():t.post()}}),this.$root.find(".add_vote_btn").click(function(){if(!PosterContext.getContext().user.canVote){var t=PosterContext.getContext().forum.nameEncoded;return $.tb.alert({title:"\u53D1\u8D77\u6295\u7968",message:'\u83B7\u5F97<a target="_blank" href="/f/like/level?kw='+t+'">3\u7EA7\u5934\u8854</a>\u624D\u53EF\u53D1\u8D77\u6295\u7968\u54E6~~<br />\u7533\u8BF7\u52A0\u5165\u4F1A\u5458\uFF0C\u9A6C\u4E0A\u53D1\u8D77\u6295\u7968\uFF01\uFF08\u66F4\u591A\u4F1A\u5458\u7279\u6743<a target="_blank" href="/f/like/level?kw= '+t+'">\u70B9\u6B64\u67E5\u770B</a>',buttons:{text:"\u786E\u5B9A"}}),!1}}),this.$root.find(".j_disable_float").click(function(){t.disableFloatingPoster()}),this.observe("insertimage",function(e,o){t.editor.execCommand("insertimage",[o])}),this.observe("file_added.attachment",function(){t.togglePostState(!0)}),this.observe("upload_complete.attachment",function(){t.togglePostState(!1)}),this.observe("wanna_post",function(){PosterContext.getAuthorities().float_editor?t.enableFloatingPoster():$.tb.location.setHash("sub"),t.focus()});var e=this.$root.find(".add_guessing_btn").on("click",function(){t.guessingDialog?t.guessingDialog._dialog.show():t.guessingDialog=t.use("encourage/widget/PostGuessingNew",{container:$("#tb_rich_poster .poster_body")}),$(this).addClass("cur"),o.removeClass("cur"),$("#tb_rich_poster_container").height(512)}),o=this.$root.find(".add_thread_btn").on("click",function(){t.guessingDialog&&t.guessingDialog._dialog.hide(),$(this).addClass("cur"),e.removeClass("cur"),$("#tb_rich_poster_container").height("auto")})},initTitle:function(){this.initTitleWordLimit(),this.initTitlePrefix()},initFloatingToolbar:function(){function t(){s.removeClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),o=!1}var e=this,o=!1,i=this.$root.find(".editor_bottom_panel"),s=this.$root.find(".j_floating");if(this.$window.scroll(function(){if(e.editor.$container.height()>e.$window.height()){var n=e._viewPortOn(e.$root);if(n.isOnScreen){var r=e._viewPortOn(i);r.bottomToBottom>=0?o&&t():n.topToBottom>400?(s.addClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),o=!0):(s.addClass("poster_locked_toolbar").removeClass("poster_floating_toolbar"),o=!0)}else o&&t()}else o&&t()}),this.bind("draft_clean",t),this.bind("poster_float",t),"1"!=$.tb.Storage.get("close_long_editor_bubble")){var n={content:"\u5DF2\u4E3A\u4F60\u5F00\u542F\u8D85\u957F\u53D1\u8D34\u6846\u529F\u80FD\uFF0C\u4E86\u89E3\u66F4\u591A\u6216\u5173\u95ED\u6B64\u529F\u80FD<a href='http://tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:80,left:100,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},r=new UiBubbleTipBase(n);r.bind("onclose",function(){$.tb.Storage.set("close_long_editor_bubble","1",(new Date).getTime()+2592e6),r.closeBubble()}),r.showBubble()}},initTitleWordLimit:function(){var t=this,e=$("#tb_rich_poster"),o={inputObj:this.$title,checkDelay:200,showLimit:10,maxNum:60,isLimitInput:!0},i=this.requireInstance("pcommon/widget/WordLimit",o);i.init(),i.bind("wlshowing",function(){e.find(".j_surveillance").hide(),t.$root.hasClass("tb_floating_poster")&&i.holder.css("zIndex",1e4)}),i.bind("wlhiding",function(){e.find(".j_surveillance").show(),i.holder.css("zIndex","auto")})},initTitlePrefix:function(){var t={$target:this.$title,prefix:this.prefix};this.requireInstance("pcommon/widget/PostPrefix",t)},initEditor:function(){if(PosterContext.isPostAllowed()){var t={};t.excludePlugins=["medal"],t.contentWidth=568,t.initialFrameWidth=598,PosterContext.getAuthorities().long_editor&&(t.autoFloatEnabled=!0,t.topOffset=this.isFrs?40:0,t.heightLimit=!1),PosterContext.getAuthorities().emotion_transform||t.excludePlugins.push("emotion_transform"),this.editor=UE.getEditor("ueditor_replace",t),this.initBubble()}else this.editor=UE.getEditor("ueditor_replace",{toolbar:""});window.test_editor=this.editor,window.test_poster=this},initBubble:function(){var t=this,e=this.requireInstance("pcommon/component/BubbleFactory");return e.getPropId()&&e.getCurrent()?(t.editor.ready(function(){t.editor.execCommand("background","bubble",e.getCurrent().background),t.editor.execCommand("setmsg",e.getCurrent())}),t.hideHolder=1,void 0):(this.isBeMember()&&!$.cookie("bubguide")&&this.editor.execCommand("setmsg","MSG_USE_GUIDE"),void 0)},initDraft:function(){var t=this,e=this.$root.find(".j_draft"),o=e.children(".j_content"),i=e.children(".j_clear");this.$root.on("saved.draft",function(){o.text("\u4F60\u6B63\u5728\u8F93\u5165\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u4FDD\u5B58, "+$.dateFormat(new Date,"HH:mm:ss")),e.show()}),this.$root.on("restored.draft",function(){o.text("\u4F60\u4E0A\u6B21\u672A\u53D1\u8868\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u6062\u590D"),e.show()}),i.on("click",function(){t.editor.clearDraft(),t.editor.setContent(""),e.hide(),t.trigger("draft_clean")})},initPlaceholder:function(){var t=this,e=0,o=this.requireInstance("puser/widget/userApi",[]),i=o.checkSuperMemberShipOf(window.PageData.user),s=window.PageUnit.load("rich_poster_placeholder").indexOf("\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C")>0;if(this.$placeholder=$('<div class="tb_poster_placeholder"></div>'),this.$placeholder.click(function(e){$(e.target).is("a")||(t.$placeholder.hide(),t.editor.focus())}),this.editor.ready(function(){t.$placeholder.prependTo(t.$root.find(".edui-container")),t.editor.addListener("focus",function(){t.$placeholder.hide()}),t.editor.addListener("blur",function(){e||t._showPlaceHolder()}),t._showPlaceHolder()}),this.$root.on("restored.draft",function(){t.$placeholder.hide()}),this.QinglangData&&this.QinglangData.content&&PageData.is_login){this.$placeholder.css({left:15,top:55});var n='<p style="width:565px;line-height:25px;">'+this.QinglangData.content+"</p>";this.$placeholder.html(n)}else i&&s?this.$placeholder.html(""):(this.$placeholder.html(this._payMemberTpl),this.bindSuperMemberExpUpTrack());this.$editorContainer.on("setbackground",function(o,i){return"default"!==i&&i?(t.hideHolder=1,t.$placeholder.hide(),void 0):(e||(t.hideHolder=0,t._showPlaceHolder()),void 0)}),this.$placeholder.find("a").on("click",function(){var t="";"frs"==PageData.product?t="frs":"pb"==PageData.product&&(t="pb"),$.stats.track("\u53D1\u8868\u56DE\u590D\u6846PlaceHolder","\u8D34\u5427PC\u9875\u9762\u4F18\u5316",t,"click")}),PosterContext.getContext().user.isLogin&&"\u8D34\u5427\u610F\u89C1\u53CD\u9988"==PosterContext.getContext().forum.name&&this.$placeholder.addClass("tb_poster_plain_placeholder").html(PageUnit.load("rich_poster_feedback"))},_showPlaceHolder:function(){var t=this.editor.getContent();0!=t.length||this.hideHolder||this.$placeholder.show()},initMousePwd:function(){this.MousePwd=this.requireInstance("pcommon/widget/MousePwd"),this.MousePwd.start(["editor_content_wrapper"])},initSignature:function(){var t=this,e=this.$root.find(".j_poster_signature"),o=t.$root.find(".j-beyond-push");e.hide(),PosterContext.getContext().user.isLogin&&this.$root.find("#ueditor_replace").one("click",function(){var i=t.use("pcommon/widget/PostSignature",{$container:e,gameSignature:PosterContext.getContext().user.gameSignature});i.init(),e.show().css("display","inline-block"),o.show().css("display","inline-block")})},isBeMember:function(){var t=window.PageData.user;return t.mParr_props&&t.mParr_props.level&&parseInt(t.mParr_props.level.props_id,10)>0&&1e3*t.mParr_props.level.end_time>Env.server_time?!0:!1},showPostSuccess:function(t){t=t||{data:{}};var e="",o="",i="",s="\u751F\u6D3B\u6742\u8C08",n=window.PageData.user;if(n.mParr_props&&n.mParr_props.level&&this.isBeMember()){var r=n.mParr_props.level.props_id;e=['<div class="pre_icon_wrap pre_icon_wrap_theme2 '+(this.isIntelligentCategory()?"pre_icon_wrap_theme2_cate":"")+'">','<span class="icon_tbworld tbworld_lv'+r+'" title="\u9AD8\u7EA7\u8D34\u5427\u4F1A\u5458"></span>',"</div>"].join("")}this.isIntelligentCategory()?(i=i||t.data.second_class_id,s=$.trim($('.j_poster_cate_radio[value="'+i+'"]').parent().text())||s,o='<div class="tb_poster_info poster_success poster_local_cate_success"><div>'+e+'<strong>\u53D1\u8868\u6210\u529F\uFF01</strong><span class="tb_poster_experience">\u7ECF\u9A8C+1</span><div class="tb_poster_line"></div><center>\u60A8\u7684\u8D34\u5B50\u5DF2\u88AB\u5206\u7C7B\u4E3A\uFF1A<span class="tb_poster_cate">'+s+"</span><br/>\u8BE6\u60C5\u53EF\u5230i\u8D34\u5427\u67E5\u770B</center></div></div>"):o='<div class="tb_poster_info poster_success"><div>'+e+"<strong>\u53D1\u8868\u6210\u529F\uFF01</strong></div></div>",$(o).appendTo(this.$editorContainer)},bindSuperMemberExpUpTrack:function(){if(-1!=$(".j-placeholder-pay-member").html().indexOf("\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C")){var t=this;t.$placeholder.on("click","a",function(){if(!PageData.user.is_login)return t.requireInstance("pcommon/widget/LoginDialog"),!1;var e=t.requireInstance("pcommon/widget/payMember"),o={fr:"\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF",scene_id:1007001003};e.showCashier(o),$.stats.track("\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF","\u4F1A\u5458\u52A0\u901F2.0")})}},showWarning:function(t){void 0==this.$warning&&(this.$warning=$('<div class="tb_poster_info poster_warning"></div>').appendTo(this.$editorContainer)),this.$warning.html(t)},getTitle:function(){return this.$title?this.$title.val():""},getClassId:function(){return this.$classId?this.$classId.val():void 0},isIntelligentCategory:function(){return!!$(".j_is_intel_cate").length},getContent:function(){return this.editor.getContent()},getContentUbb:function(){return this.editor.getContentUbb()},getGameUser:function(){var t=PosterContext.getContext().user.gameSignature;return t&&!$.isEmptyObject(t.signature_info)},getPostType:function(){var t=this.isFrs?"thread":"reply";return this.editor.getExtendContent().hasLocalVideo&&(t="thread"==t?"vpostThread":"vpostReply"),t},getPostData:function(){var t=this.editor.getExtendContent(),e={content:this.getContentUbb()};if(this.isFrs){var o=this.getTitle(),i=this.$title.data("prefix");-1==o.indexOf(i)&&(i=""),o=o.replace(/\u2006/g,""),o=o.replace(i,""),e.title=o,e.prefix=i;var s=this.$root.find("#rewards_check");if(s.length&&"checked"==s.tbattr("checked")){var n=this.PostReward.getPosterData();$.extend(e,n)}var r=this.getClassId();this.isIntelligentCategory()&&(r&&(e.second_class_id=r),e.cur_scid=$(".j_cur_scid").val(),e.is_intel_cate=1)}t.videoNumber>0&&(e.video_url=t.videoUrl,t.hasLocalVideo&&(e.file_id=t.fileId)),t.ptype&&(e.ptype=t.ptype),t.attachments&&(e.files=t.attachments);var a=this.$root.find(".j_sign_id"),l=this.$root.find(".j_use_signature");l.tbattr("checked")&&a.size()>0&&a.val()&&(e.sign_id=a.val());var d=this.$root.find(".j-beyond-push-checkbox");if(d.tbattr("checked")&&(e.pushToBeyond=1,e.beyondType=this.beyondType),e.game_user=this.getGameUser(),e.mouse_pwd=this.MousePwd.report().c,e.mouse_pwd_t=this.MousePwd.time,e.mouse_pwd_isclick=this.MousePwd.MOUSEPWD_CLICK,this.isPb&&PosterContext.getContext().thread&&22==PosterContext.getContext().thread.thread_type){var c={rewards:1};$.extend(e,c)}return e},togglePostState:function(t){var e=this.$root.find(".j_posting_status");e.toggleClass("poster_posting_status_loading",t),this.toggleSubmitButton(t)},toggleSubmitButton:function(t){this.$submit.toggleClass("ui_btn ui_btn_m",!t),this.$submit.toggleClass("ui_btn_disable ui_btn_m_disable",t)},validateContent:function(){var t,e=this.isFrs?3e4:1e4,o=this.editor.getContentByteLength(),i=this.editor.getContentLength(),s=this.editor.getExtendContent(),n=this.$root.find(".ueditor_container .j_error"),r=this.$root.find(".j-beyond-push-checkbox");if(this.isFrs){var a=$.trim(this.getTitle()),l=this.$title.data("prefix");if(0===a.length)return this.$root.find(".title_container .j_error").text("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;if(0===a.replace(l,"").length)return this.$root.find(".title_container .j_error").text("\u53EA\u6709\u524D\u7F00\u662F\u4E0D\u884C\u7684\u54DF~\u8BF7\u5728\u524D\u7F00\u540E\u586B\u5199\u6B63\u5F0F\u6807\u9898\uFF01").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1}return this.isFrs&&r.tbattr("checked")&&0===i?(n.text("\u60A8\u9009\u62E9\u4E86\u63A8\u9001\u5230\u8D34\u5427\u5A31\u4E50\uFF0C\u8BF7\u586B\u5199\u5E16\u5B50\u5185\u5BB9").show(),!1):0!==o||this.isFrs?o>e?(t="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+e/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4",n.text(t).show(),!1):s.videoNumber>1?(t="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u89C6\u9891\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC71\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",n.text(t).show(),!1):s.musicNumber>10?(t="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u97F3\u4E50\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",n.text(t).show(),!1):s.ptype&&!s.ptypePower?(t="\u6CA1\u6709\u9053\u5177\u4F7F\u7528\u6743\u9650\u5C06\u65E0\u6CD5\u53D1\u8868\u6210\u529F",n.text(t).show(),!1):(this.$root.find(".j_error").hide(),!0):(n.text("\u56DE\u590D\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show(),!1)},post:function(t){var e=this.postData=this.getPostData(),o=this.validateContent();"object"==typeof postObj&&"object"==typeof t&&$.extend(e,t),!this.postService.isPosting()&&o&&(PosterContext.context.user.isLogin?($.cookie("GET_TOPIC","-",{expires:-1,path:"/"}),this.postService.post(this.getPostType(),e,PosterContext.getContext()),this.togglePostState(!0),this.requireInstanceAsync("pfrs/widget/snowflow",[e.content,PosterContext.getContext().product,"rich_poster"])):this.requireInstanceAsync("pcommon/widget/LoginDialog",["","editor",function(){$.stats.track("\u53D1\u8868\u6309\u94AE_\u767B\u5F55\u6210\u529F","\u975E\u767B\u5F55\u7528\u6237\u53D1\u5E16")}]))},refresh:function(){var t=$.tb.location.getHref();t=t.replace(/#\w*$/,""),$.tb.location.reload()},focus:function(){this.isFrs?this.$title.focus():$.browser.msie&&$.browser.version<=7||this.editor.focus()},enableFloatingPoster:function(){var t=this;if(!this.$root.hasClass("tb_floating_poster")&&(this.editor.enableHeightLimit(this.$window.height()-450),this.trigger("poster_float"),this.$root.hide().addClass("tb_floating_poster"),this.position&&this.$root.css(this.position),this.$root.fadeIn(function(){t.$root.draggable({handle:t.$root.find(".poster_head"),start:function(){t.$root.css({right:"auto",bottom:"auto"})}})}),"1"!=$.tb.Storage.get("close_float_draggable_bubble"))){var e={content:"\u6D6E\u52A8\u53D1\u8D34\u6846\u53EF\u4EE5<span class='ui_text_emphasize'>\u62D6\u62FD</span>\u4E86\uFF0C\u8D76\u5FEB\u62D6\u52A8\u6807\u9898\u8BD5\u8BD5\uFF01\u66F4\u591A\u8BE6\u60C5<a href='http://tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:0,left:10,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},o=new UiBubbleTipBase(e);o.bind("onclose",function(){$.tb.Storage.set("close_float_draggable_bubble","1",(new Date).getTime()+2592e6),o.closeBubble()}),o.showBubble()}},disableFloatingPoster:function(){var t=this;t.$root.fadeOut(function(){t.position={left:t.$root.css("left"),top:t.$root.css("top")},t.$root.draggable("destroy").css({left:"auto",top:"auto"}),t.$root.removeClass("tb_floating_poster").show(),PosterContext.getAuthorities().long_editor?t.editor.disableHeightLimit():t.editor.enableHeightLimit()})},_viewPortOn:function(t){var e=this.$window.scrollTop(),o=e+this.$window.height(),i=t.offset().top,s=i+t.height();return{isOnScreen:o>i&&s>e,topToBottom:o-i,bottomToTop:s-e,topToTop:i-e,bottomToBottom:o-s}},setBlessCookie:function(){var t=PosterContext.getContext().forum.id,e=$.cookie("bless_post_"+t);null==e&&$.cookie("bless_post_"+t,1,1)},initPostReward:function(){var t=this,e=PosterContext.getContext().thread;this.isPb&&e&&22==e.thread_type&&this.observe("rewardsSuccess",function(){t.editor.setContent(""),t.editor.clearDraft()})},isKeywordBubble:function(t){var e=+new Date;return null!=this.keywordBubbleConf&&2===this.keywordBubbleConf.status&&this.keywordBubbleConf.beginTime<e&&e<this.keywordBubbleConf.endTime&&t.indexOf(this.keywordBubbleConf.keyword)>=0},showKeywordBubble:function(){var t=this.keywordBubbleConf,e=0;t.remainNum>0&&(e=t.keywordLotteryNum+t.postLotteryNum,e=Math.min(e,t.remainNum),t.remainNum-=e);var o=baidu.template('<div class="tb-poster-keyword-bubble">     <div class="keyword-bubble-animation"></div>     <img src="<%= logoUrl %>" class="keyword-bubble-logo" alt="logo">     <% if (lotteryNum > 0) { %>     <p class="keyword-bubble-text">\u606D\u559C\u4F60\u53C8\u83B7\u5F97<span class="keyword-bubble-text-strong"><%= lotteryNum %>\u6B21\u62BD\u5956\u673A\u4F1A</span>\u54E6~</p>     <% } %> </div>',{logoUrl:this.keywordBubbleConf.logoUrl,lotteryNum:e});$(o).appendTo(this.$editorContainer)},removeKeywordBubble:function(){$(".tb-poster-keyword-bubble").remove()},showBeyondTypeDialog:function(){var t=this,e='<!-- \u63A8\u9001\u5230\u8D34\u5427\u5A31\u4E50\u9891\u9053\u5F00\u5173\u5F39\u7A97 --> <div class="beyond-push-wrapper">  <div class="col2-left">   <label>\u9009\u62E9\u5206\u7C7B\uFF1A</label>  </div>     <div class="col2-right">      <div class="beyond-list">    <span class="item" data-type="1">\u660E\u661F</span>    <span class="item" data-type="2">\u7535\u5F71</span>    <span class="item" data-type="3">\u7535\u89C6\u5267</span>    <span class="item" data-type="4">\u7EFC\u827A</span>    <span class="item" data-type="5">\u6D3B\u52A8</span>    </div>      </div>    <div class="beyond-submit">   <button class="btn-default btn-middle beyond-submit-btn">\u786E\u5B9A</button>  </div> </div>',o=new $.dialog({html:e,title:"\u63A8\u9001\u5230\u8D34\u5427\u5A31\u4E50",closeable:!0,width:420}),i=o.element;i.on("click",".beyond-list .item",function(){$(this).addClass("selected").siblings().removeClass("selected")}),i.on("click",".beyond-submit-btn",function(){var e=i.find(".beyond-list .selected");t.beyondType=e.data("type"),e.length?(o.hide(),t.post({beyondType:t.beyondType})):new $.dialog({html:"\u8BF7\u9009\u62E9\u4E00\u9879\u5206\u7C7B",title:"\u767E\u5EA6\u8D34\u5427",closeable:!0})})}}});_.Module.define({path:"pplatform/widget/footerSpread",requires:[],sub:{initial:function(){$("#left-cont-wraper").css("bottom","350px"),$("#right_wrap").css("bottom","250px"),$(".tbui_aside_float_bar").css("bottom","370px"),$(".tbui_aside_float_bar").css("margin-left","518px");var t=$(".third_promote_text_container ul li");t.each(function(){var t=$(this).find("a"),a=t.text();t.text(a.substring(0,16))}),this.showTrack()},showTrack:function(){var t=$.getPageData("product");$.stats.track("\u5E95\u90E8\u63A8\u5E7F\u4F4D","\u5E95\u90E8\u63A8\u5E7F\u4F4D",t,"show")}}});function HourGlass(t,a,e){this.hasEntered=!1,this.beatId="",this.rate=t?t:20,this.paras=a,this.isActive=e||PageData.user.is_login}_.Module.define({path:"ppb/widget/Stat",sub:{initial:function(){$.stats.scanPage(),this._hgTongji(),this._bdTongji(),this._wpoTongji(),this._baiduSearch()},_baiduSearch:function(){$.JsLoadManager.use(["http://s1.bdstatic.com/r/www/cache/baidu_search/baiduSearch-1.4.js"],function(){baidusearch.init("SE_hldp00980_x3znwgz5")},!1,"utf-8")},_hgTongji:function(){var t=new HourGlass(20,{hg_mod:"pb",hg_uid:PageData.user.name_url,hg_kw:PageData.forum.name_url,hg_type:"bright"},!1);t.init();var a=["\u9B54\u517D\u4E16\u754C","2012","\u6050\u6016","LOL","\u82F1\u96C4\u8054\u76DF","\u68A6\u5E7B\u897F\u6E38","\u5766\u514B\u4E16\u754C","\u7A7F\u8D8A\u706B\u7EBF","\u9B54\u517D\u73A9\u5BB6","\u6D1B\u5947\u82F1\u96C4\u4F20","\u5251\u7F513","\u4E09\u56FD\u6740","dnf\u7EA2\u773C","sd\u6562\u8FBE","\u95EE\u9053","\u5192\u9669\u5C9B","\u827E\u5C14\u4E4B\u5149","dnf\u963F\u4FEE\u7F57","\u5929\u9F99\u7F51\u6E38","\u68A6\u4E09\u56FD","dnf\u9B3C\u6CE3","dnf\u53EC\u5524\u5E08","dnf\u5251\u9B42","aion","dnf\u67AA\u795E","dnf\u6B66\u795E","qq\u70AB\u821E","qq\u4E09\u56FD","dnf\u5546\u4EBA","\u795E\u6B66\u900D\u9065\u5916\u4F20","dnf\u5143\u7D20","\u84DD\u62F3","psv","\u7B2C\u4E5D\u5927\u9646","eve","\u7CBE\u6B66\u5802","q\u5BA0\u5927\u4E50\u6597","\u5029\u5973ol","dnf\u9A71\u9B54","dnf\u67D4\u9053","\u4E09\u56FD\u5FD712","dnf\u7537\u6C14\u529F","\u9ED1\u4E1D","\u7EF4\u5C3C\u592B\u5987","\u8DEF\u8FC7\u7684\u4E00\u53EA","les","\u51CF\u80A5","\u5BD2\u6B66\u7EAA\u5E74","\u5723\u738B","\u7231\u60C5","\u8D34\u5427\u63A8\u5E7F"];if($.inArray(PageData.forum.forum_name,a)){var e=new HourGlass(20,{fr:"nfrspb",fname:PageData.forum.name_url,v:1,bduid:$.cookie("BAIDUID"),uid:PageData.user.user_id},!0);e.init()}},_bdTongji:function(){var t="",a=0,e=document.cookie.match(/(^| )BAIDUID=(\w+)/);e&&(t=e[2]);for(var i=t.length-1;i>=0;i--)a+=t.charCodeAt(i);if(e&&2>a%10){var n="https:"==document.location.protocol?" https://":" http://";$.JsLoadManager.use([n+"hm.baidu.com/h.js?287705c8d9e2073d13275b18dbd746dc"],function(){Stats.sendRequest("fr=tb0_forum&st_mod=bdtj46dc&st_type=pb")})}},_wpoTongji:function(){window.alogObjectConfig={product:"14",page:"14_8",monkey_page:"tieba-pb",speed_page:"1",speed:{sample:"0.05"},monkey:{sample:"0.05",hid:"762"},exception:{sample:"0.05"},csp:{sample:"0.004","script-src":[{match:"*bae.baidu.com",target:"Accept,Warn"},{match:"*.baidu.com,*.bdstatic.com,*.baidustatic.com,*.bdimg.com,www.aipai.com,jump.luna.58.com,www.pokersc.cn",target:"Accept"},{match:/^(127|172|192|10)(\.\d+){3}$/,target:"Accept"},{match:"*",target:"Accept,Warn"}]}}}}}),HourGlass.prototype={constructor:HourGlass,init:function(){this.isActive&&($("body").bind("mouseover",{obj:this},function(t){t.data.obj.enter()}),$("body").bind("mouseleave",{obj:this},function(t){t.data.obj.leave()}))},parasToQuery:function(){var t="";for(var a in this.paras)t+=a+"="+this.paras[a]+"&";return t.substr(0,t.length-1)},enter:function(){this.hasEntered||(this.hasEntered=!0,this.startBeat())},leave:function(){this.hasEntered&&(this.hasEntered=!1,this.stopBeat())},startBeat:function(){var t=this;this.beatId=setInterval(function(){t.beat()},1e3*t.rate)},stopBeat:function(){clearInterval(this.beatId)},beat:function(){var t=new Image;window["bd_hg2_"+(new Date).getTime()]=t,t.src="http://tb1.bdstatic.com/tb/img/hg/hg.gif?"+this.parasToQuery()+"&t="+(new Date).getTime(),t=null}};var T,baidu=T=baidu||{version:"1.5.0"};baidu.guid="$BAIDU$",window[baidu.guid]=window[baidu.guid]||{},baidu.fn=baidu.fn||{},baidu.fn.blank=function(){},baidu.string=baidu.string||{},baidu.string.format=function(t,e){t=String(t);var i=Array.prototype.slice.call(arguments,1),n=Object.prototype.toString;return i.length?(i=1==i.length?null!==e&&/\[object Array\]|\[object Object\]/.test(n.call(e))?e:i:i,t.replace(/#\{(.+?)\}/g,function(t,e){var s=i[e];return"[object Function]"==n.call(s)&&(s=s(e)),"undefined"==typeof s?"":s})):t},baidu.format=baidu.string.format,baidu.object=baidu.object||{},baidu.object.each=function(t,e){var i,n,s;if("function"==typeof e)for(n in t)if(t.hasOwnProperty(n)&&(s=t[n],i=e.call(t,s,n),i===!1))break;return t},baidu.extend=baidu.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},baidu.number=baidu.number||{},baidu.number.pad=function(t,e){var i="",n=0>t,s=String(Math.abs(t));return s.length<e&&(i=new Array(e-s.length+1).join("0")),(n?"-":"")+i+s},baidu.platform=baidu.platform||{},baidu.platform.isAndroid=/android/i.test(navigator.userAgent),baidu.platform.isIpad=/ipad/i.test(navigator.userAgent),baidu.platform.isIphone=/iphone/i.test(navigator.userAgent),baidu.swf=baidu.swf||{},baidu.browser=baidu.browser||{},baidu.browser.ie=baidu.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,baidu.array=baidu.array||{},baidu.array.remove=function(t,e){for(var i=t.length;i--;)i in t&&t[i]===e&&t.splice(i,1);return t},baidu.lang=baidu.lang||{},baidu.lang.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},baidu.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},baidu.lang.toArray=function(t){if(null===t||void 0===t)return[];if(baidu.lang.isArray(t))return t;if("number"!=typeof t.length||"string"==typeof t||baidu.lang.isFunction(t))return[t];if(t.item){for(var e=t.length,i=new Array(e);e--;)i[e]=t[e];return i}return[].slice.call(t)},baidu.swf.getMovie=function(t){var e,i=document[t];return 9==baidu.browser.ie?i&&i.length?1==(e=baidu.array.remove(baidu.lang.toArray(i),function(t){return"embed"!=t.tagName.toLowerCase()})).length?e[0]:e:i:i||window[t]},baidu.swf.version=function(){var t=navigator;if(t.plugins&&t.mimeTypes.length){var e=t.plugins["Shockwave Flash"];if(e&&e.description)return e.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(window.ActiveXObject&&!window.opera)for(var i=12;i>=2;i--)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i);if(n){var s=n.GetVariable("$version");return s.replace(/WIN/g,"").replace(/,/g,".")}}catch(a){}}(),baidu.string.encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},baidu.encodeHTML=baidu.string.encodeHTML,baidu.swf.createHTML=function(t){t=t||{};var e,i,n,s,a,r,o=baidu.swf.version,u=t.ver||"6.0.0",l={},h=baidu.string.encodeHTML;for(s in t)l[s]=t[s];if(t=l,!o)return"";for(o=o.split("."),u=u.split("."),n=0;3>n&&(e=parseInt(o[n],10),i=parseInt(u[n],10),!(e>i));n++)if(i>e)return"";var d=t.vars,c=["classid","codebase","id","width","height","align"];if(t.align=t.align||"middle",t.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",t.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0",t.movie=t.url||"",delete t.vars,delete t.url,"string"==typeof d)t.flashvars=d;else{var g=[];for(s in d)r=d[s],g.push(s+"="+encodeURIComponent(r));t.flashvars=g.join("&")}var p=["<object "];for(n=0,a=c.length;a>n;n++)r=c[n],p.push(" ",r,'="',h(t[r]),'"');p.push(">");var f={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(s in t)r=t[s],s=s.toLowerCase(),f[s]&&(r||r===!1||0===r)&&p.push('<param name="'+s+'" value="'+h(r)+'" />');t.src=t.movie,t.name=t.id,delete t.id,delete t.movie,delete t.classid,delete t.codebase,t.type="application/x-shockwave-flash",t.pluginspage="http://www.macromedia.com/go/getflashplayer",p.push("<embed");var m;for(s in t)if(r=t[s],r||r===!1||0===r){if(new RegExp("^salign$","i").test(s)){m=r;continue}p.push(" ",s,'="',h(r),'"')}return m&&p.push(' salign="',h(m),'"'),p.push("></embed></object>"),p.join("")},baidu.swf.create=function(t,e){t=t||{};var i=baidu.swf.createHTML(t)||t.errorMessage||"";e&&"string"==typeof e&&(e=document.getElementById(e)),e?e.innerHTML=i:document.write(i)},function(){var t=window[baidu.guid];baidu.lang.guid=function(){return"TANGRAM__"+(t._counter++).toString(36)},t._counter=t._counter||1}(),window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class=function(t){this.guid=t||baidu.lang.guid(),window[baidu.guid]._instances[this.guid]=this},window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class.prototype.dispose=function(){delete window[baidu.guid]._instances[this.guid];for(var t in this)baidu.lang.isFunction(this[t])||delete this[t];this.disposed=!0},baidu.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},baidu.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},baidu.isString=baidu.lang.isString,baidu.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},baidu.lang.Class.prototype.addEventListener=function(t,e,i){if(baidu.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,s=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof s[t]&&(s[t]={}),n=n||baidu.lang.guid(),e.hashCode=n,s[t][n]=e}},baidu.lang.Class.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;if(i[t])if("undefined"!=typeof e)i[t][e]&&delete i[t][e];else for(var n in i[t])delete i[t][n]}},baidu.lang.Class.prototype.dispatchEvent=function(t,e){baidu.lang.isString(t)&&(t=new baidu.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,s=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),baidu.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof n[s])for(i in n[s])n[s][i].apply(this,arguments);return t.returnValue},baidu.lang.createClass=function(t,e){e=e||{};var i=e.superClass||baidu.lang.Class,n=function(){i!=baidu.lang.Class?i.apply(this,arguments):i.call(this),t.apply(this,arguments)};n.options=e.options||{};var s=function(){},a=t.prototype;s.prototype=i.prototype;var r=n.prototype=new s;for(var o in a)r[o]=a[o];return"string"==typeof e.className&&(r._className=e.className),r.constructor=a.constructor,n.extend=function(t){for(var e in t)n.prototype[e]=t[e];return n},n},baidu.lang.inherits=function(t,e,i){var n,s,a=t.prototype,r=new Function;r.prototype=e.prototype,s=t.prototype=new r;for(n in a)s[n]=a[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(s._className=i)},baidu.inherits=baidu.lang.inherits,baidu.lang.isBoolean=function(t){return"boolean"==typeof t},baidu.lang.isElement=function(t){return!(!t||!t.nodeName||1!=t.nodeType)},baidu.lang.isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)&&isFinite(t)},baidu.lang.isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},baidu.isObject=baidu.lang.isObject,baidu.fn.bind=function(t,e){var i=arguments.length>2?[].slice.call(arguments,2):null;return function(){var n=baidu.lang.isString(t)?e[t]:t,s=i?i.concat([].slice.call(arguments,0)):arguments;return n.apply(e||n,s)}},baidu.each=baidu.array.forEach=baidu.array.each=function(t,e,i){var n,s,a,r=t.length;if("function"==typeof e)for(a=0;r>a&&(s=t[a],n=e.call(i||t,s,a),n!==!1);a++);return t},baidu.array.some=function(t,e,i){for(var n=0,s=t.length;s>n;n++)if(n in t&&e.call(i||t,t[n],n))return!0;return!1},baidu.browser.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.firefox=/firefox\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.isWebkit=/webkit/i.test(navigator.userAgent);try{/(\d+\.\d+)/.test(external.max_version)&&(baidu.browser.maxthon=+RegExp.$1)}catch(e){}!function(){var t=navigator.userAgent;baidu.browser.safari=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)?+(RegExp.$1||RegExp.$2):void 0}(),baidu.dom=baidu.dom||{},baidu.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},baidu.g=baidu.G=baidu.dom.g,baidu.dom._styleFixer=baidu.dom._styleFixer||{},baidu.dom._styleFilter=baidu.dom._styleFilter||[],baidu.dom._styleFilter.filter=function(t,e,i){for(var n,s=0,a=baidu.dom._styleFilter;n=a[s];s++)(n=n[i])&&(e=n(t,e));return e},baidu.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},baidu.dom.setStyle=function(t,e,i){var n,s=baidu.dom;return t=s.g(t),e=baidu.string.toCamelCase(e),(n=s._styleFilter)&&(i=n.filter(e,i,"set")),n=s._styleFixer[e],n&&n.set?n.set(t,i):t.style[n||e]=i,t},baidu.setStyle=baidu.dom.setStyle,baidu.dom.setStyles=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setStyle(t,i,e[i]);return t},baidu.setStyles=baidu.dom.setStyles,baidu.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return baidu.browser.ie<8?(t["for"]="htmlFor",t["class"]="className"):(t.htmlFor="for",t.className="class"),t}(),baidu.dom.setAttr=function(t,e,i){return t=baidu.dom.g(t),"style"==e?t.style.cssText=i:(e=baidu.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},baidu.setAttr=baidu.dom.setAttr,baidu.dom.setAttrs=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setAttr(t,i,e[i]);return t},baidu.setAttrs=baidu.dom.setAttrs,baidu.dom.create=function(t,e){var i=document.createElement(t),n=e||{};return baidu.dom.setAttrs(i,n)},baidu.cookie=baidu.cookie||{},baidu.cookie._isValidKey=function(t){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(t)},baidu.cookie.getRaw=function(t){if(baidu.cookie._isValidKey(t)){var e=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),i=e.exec(document.cookie);if(i)return i[2]||null}return null},baidu.cookie.get=function(t){var e=baidu.cookie.getRaw(t);return"string"==typeof e?e=decodeURIComponent(e):null},baidu.cookie.setRaw=function(t,e,i){if(baidu.cookie._isValidKey(t)){i=i||{};var n=i.expires;"number"==typeof i.expires&&(n=new Date,n.setTime(n.getTime()+i.expires)),document.cookie=t+"="+e+(i.path?"; path="+i.path:"")+(n?"; expires="+n.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")}},baidu.cookie.remove=function(t,e){e=e||{},e.expires=new Date(0),baidu.cookie.setRaw(t,"",e)},baidu.cookie.set=function(t,e,i){baidu.cookie.setRaw(t,encodeURIComponent(e),i)},baidu.sio=baidu.sio||{},baidu.sio._createScriptTag=function(t,e,i){t.setAttribute("type","text/javascript"),i&&t.setAttribute("charset",i),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t)},baidu.sio._removeScriptTag=function(t){if(t.clearAttributes)t.clearAttributes();else for(var e in t)t.hasOwnProperty(e)&&delete t[e];t&&t.parentNode&&t.parentNode.removeChild(t),t=null},baidu.sio.callByServer=function(t,e,i){function n(t){return function(){try{t?l.onfailure&&l.onfailure():(e.apply(window,arguments),clearTimeout(a)),window[s]=null,delete window[s]}catch(i){}finally{baidu.sio._removeScriptTag(o)}}}var s,a,r,o=document.createElement("SCRIPT"),u="bd__cbs__",l=i||{},h=l.charset,d=l.queryField||"callback",c=l.timeOut||0,g=new RegExp("(\\?|&)"+d+"=([^&]*)");baidu.lang.isFunction(e)?(s=u+Math.floor(2147483648*Math.random()).toString(36),window[s]=n(0)):baidu.lang.isString(e)?s=e:(r=g.exec(t))&&(s=r[2]),c&&(a=setTimeout(n(1),c)),t=t.replace(g,"$1"+d+"="+s),t.search(g)<0&&(t+=(t.indexOf("?")<0?"?":"&")+d+"="+s),baidu.sio._createScriptTag(o,t,h)};var mbox=mbox||{};T.extend(mbox,{namespace:function(){var t,e,i,n=arguments,s=null;for(t=0,len=n.length;len>t;t++)for(i=(""+n[t]).split("."),s=mbox,e="mbox"==i[0]?1:0;e<i.length;e+=1)s[i[e]]=s[i[e]]||{},s=s[i[e]];return s},Fuze:function(){var t,e,i;return t=[],e=function(e){i?e():t.push(e)},e.fire=function(){for(;t.length;)t.shift()();i=!0},e.extinguish=function(){i=!1},e.wettish=function(){this.fire(),this.extinguish()},e.clear=function(){for(;t.length;)t.shift();this.extinguish()},e},convertTime:function(t){var e,i;return t=Math.round(t/1e3),e=Math.floor(t/60),i=t%60,T.number.pad(e,2)+":"+T.number.pad(i,2)},Timer:function(t){var e=function(t,e){this._timer=function(){},this._listener=function(){},this._timerComplete=function(){},this._timerID=null,this._delay=this._remain=t,this._repeatCount=e||0,this._currentCount=0,this._isRunning=!1,this._startTime=this._endTime=0,this.EVENTS={TIMER:"timer",COMPLETE:"timerComplete"}};return e.prototype={_createTimer:function(e,i){var n=this;return 1==i?function(){return t.setTimeout(function(){n.reset(),n._listener(n._delay,i),n._timerComplete()},e)}:function(){return t.setInterval(function(){0!=i&&n._currentCount>=i?(n.reset(),n._timerComplete()):(n._currentCount++,n._listener(e,n._currentCount))},e)}},addEventListener:function(t,e){"timer"==t?(this._listener=e,this._timer=this._createTimer(this._delay,this._repeatCount)):"timerComplete"==t&&(this._timerComplete=e)},reset:function(){this.stop(),1==this._repeatCount&&(this._timer=this._createTimer(this._delay,this._repeatCount)),this._currentCount=0,this._remain=this._delay,this._startTime=this._endTime=0},start:function(){this._timerID||(this._timerID=this._timer(),1==this._repeatCount&&(this._startTime=(new Date).getTime()),this._isRunning=!0)},stop:function(){this._timerID&&(1==this._repeatCount?t.clearTimeout(this._timerID):t.clearInterval(this._timerID),this._timerID=null,this._isRunning=!1)},pause:function(){1==this._repeatCount?this._timerID&&(this.stop(),this._endTime=(new Date).getTime(),this._remain=this._remain-(this._endTime-this._startTime),this._remain>0?this._timer=this._createTimer(this._remain,1):this.reset()):this.stop()},getCurrentCount:function(){return this._currentCount},isRunning:function(){return this._isRunning}},e}(window),StopWatch:function(){var t=0,e=function(){this.startTime=0,this.isRunning=!1,this.isReset=!0,this.passedTime=0,t++};return e.prototype={reset:function(){this.startTime=0,this.pauseTime=0,this.passedTime=0,this.isRunning=!1,this.isReset=!0},start:function(){this.isReset?(this.reset(),this.startTime=(new Date).getTime()):this.isRunning||(this.startTime=(new Date).getTime()),this.isRunning=!0,this.isReset=!1},pause:function(){!this.isReset&&this.isRunning&&(this.pauseTime=(new Date).getTime(),this.passedTime+=this.pauseTime-this.startTime,this.isRunning=!1)},isRunning:function(){return this.isRunning},isReset:function(){return this.isReset},getTime:function(){return this.isReset?0:this.isRunning?(new Date).getTime()-this.startTime+this.passedTime:this.passedTime},getCounts:function(){return t}},e}(window)}),mbox.namespace("mbox.lang"),T.extend(mbox.lang,{createClass:function(t,e){var i=T.lang.createClass(t,e);return i.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={});var i=t.split(".");t.length>1&&(t=i[0],e=i[1]),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;if(n[t])if("undefined"!=typeof e)n[t][e]&&delete n[t][e];else for(var s in n[t])delete n[t][s]}},i.extend=function(t){for(var e in t)i.prototype[e]=function(t,e){return T.lang.isFunction(t)?function(){this.dispatchEvent(e,{name:e,arguments:arguments});var i=t.apply(this,arguments);return i}:t}(t[e],e);return i},i}});var mbox=mbox||{};!function(){var t="mbox";mbox.CONF={instanceCallName:t,autoPlay:!1,autoNext:!1,engineArg:{audio:{constructorName:"PlayEngine_Audio"},fmp:{constructorName:"PlayEngine_FMP_MP3",args:{swfPath:"http://play.baidu.com/player/static/flash/fmp.swf",instanceName:t+".player"}}},logOpt:{ref:"pc_widget_tieba"},songLinkHost:{link:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.song.play&format=jsonp&bit=128&songid=",lrc:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.song.lry&fromat=jsonp&songid=",sug:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common&page_size=1&page_no=1&query="}}}(void 0);var PlayEngine_Interface=mbox.lang.createClass(function(){var t=0,e={mute:!1,volume:50},i=function(t){this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},t=t||{},this.mute="undefined"==typeof t.mute?e.mute:!!t.mute,this.volume="undefined"==typeof t.volume?e.volume:t.volume,this.ready=!1,this.url="",this.state=this.STATES.INIT,this.engineType="",this.stateStack=[this.STATES.INIT],this.supportMimeType=[]};return i.prototype={newId:function(){return"_m3_"+t++},init:function(){},reset:function(){},setUrl:function(){},getUrl:function(){return this.url},play:function(){},pause:function(){},stop:function(){},setMute:function(){},getMute:function(){return this.mute},setVolume:function(){},getVolume:function(){return this.volume},getState:function(){return""},setCurrentPosition:function(){},getCurrentPosition:function(){return 0},getLoadedPercent:function(){return 0},getLoadedBytes:function(){return 0},getTotalBytes:function(){return 0},getTotalTime:function(){return 0},getVersion:function(){return""},getEngineType:function(){return this.engineType},canPlayType:function(t){var e=this.getSupportMimeTypeList();return T.array.some(e,function(e){return t==e})},getSupportMimeTypeList:function(){return this.supportMimeType},setEventListener:function(t,e,i){var n=T.fn.bind(function(){return e.apply(this,arguments)},this);this.addEventListener(t,n,i)}},i}(window),{superClass:T.lang.Class,className:"PlayEngine_Interface"}),PlayEngine_Audio=mbox.lang.createClass(function(t){t=t||{},this.engineType="audio",this.contentType={mp3:["audio/mpeg","audio/mp3"],mp4:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],m4a:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],aac:["audio/aac","audio/aacp"],"3gp":["audio/3gpp","audio/3gpp2"],ogg:["audio/ogg","video/ogg","application/ogg","audio/vorbis"],oga:["audio/ogg","application/ogg","audio/vorbis"],wma:["audio/x-ms-wma"]},this.supportAudio="undefined"!=typeof Audio,this.supportMimeType=[],this.supportAudio&&(this.audio=new Audio,"function"==typeof this.audio.canPlayType&&T.object.each(this.contentType,T.fn.bind(function(t,e){for(var i=0;i<t.length;i++){var n=this.audio.canPlayType(t[i]);if("probably"==n||"maybe"==n){this.supportMimeType.push(e);break}}},this)),this.supportMimeType.length||(this.supportAudio=!1)),this.supportVolume=T.fn.bind(function(){return this.supportAudio?(this.audio.volume=.5,this.audio.volume<1):!1},this)()},{superClass:PlayEngine_Interface,className:"PlayEngine_Audio"}).extend({test:function(t){return t=!!t,!this.supportAudio&&t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),this.supportAudio},init:function(){this.lastState=this.STATES.INIT,this.muted=this.audio.muted=!1,this.volume=50,this.audio.volume=.5,this.url="",this._definedEvents(),this.state=this.STATES.READY,this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.audio})},reset:function(){this.supportAudio&&(this.url="",this.audio.pause(),this.state="ready",this.lastState="ready")},setUrl:function(t){this.supportAudio&&(this.url=t,this.audio.src=t,this.audio.load(),this._firePlayStateChange(this.STATES.PREBUFFER))},play:function(){if(this.supportAudio&&"ready"!=this.state)if(T.platform.isAndroid&&T.browser.isWebkit&&this.audio.readyState<3){var t=T.fn.bind(function(){this.audio.play(),this.audio.removeEventListener("canplay",t,!1)},this);this.audio.addEventListener("canplay",t,!1)}else this.audio.play()},pause:function(){this.supportAudio&&this.state!=this.STATES.STOP&&this.state!=this.STATES.READY&&this.state!=this.STATES.END&&(this.audio.pause(),this._firePlayStateChange(this.STATES.PAUSE))},stop:function(){this.supportAudio&&this.state!=this.STATES.READY&&(0!=this.audio.currentTime&&(this.audio.currentTime=0),this.audio.pause(),this._firePlayStateChange(this.STATES.STOP))},setMute:function(t){this.supportAudio&&(this.audio.muted=this.mute=t)},setVolume:function(t){this.supportAudio&&(t=T.lang.isNumber(t)?t:50,t=Math.max(Math.min(t,100),0),this.volume=t,this.audio.volume=t/100)},setCurrentPosition:function(t){if(this.supportAudio)if(T.platform.isAndroid&&this.audio.readyState<3){var e=T.fn.bind(function(){this.audio.currentTime=t/1e3,this.audio.play(),this.audio.removeEventListener("canplay",e,!1)},this);this.audio.addEventListener("canplay",e,!1)}else this.audio.currentTime=t/1e3,this.audio.play()},getCurrentPosition:function(){return this.supportAudio?Math.round(1e3*this.audio.currentTime):0},getLoadedPercent:function(){try{var t=this.audio.buffered.end(0),e=this.audio.duration;return e=isNaN(e)?0:e,Math.round(t/e*100)/100}catch(i){return 0}},getTotalTime:function(){if(!this.supportAudio)return 0;var t=this.audio.duration;return t=isNaN(t)?0:t,Math.round(1e3*t)},getState:function(){return this.state},_firePlayStateChange:function(t){this.state!=t&&(this.lastState=this.state,this.state=t,this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:this.lastState,engineType:this.engineType}))},_definedEvents:function(){this.audio.addEventListener("error",T.fn.bind(function(){this._firePlayStateChange(this.STATES.ERROR),this.dispatchEvent(this.EVENTS.ERROR,{engineType:this.engineType})},this),!1),this.audio.addEventListener("ended",T.fn.bind(function(){this._firePlayStateChange(this.STATES.END)},this),!1),this.audio.addEventListener("playing",T.fn.bind(function(){this._firePlayStateChange(this.STATES.PLAY)},this),!1),this.audio.addEventListener("pause",T.fn.bind(function(){this.getState()==this.STATES.PLAY&&this._firePlayStateChange(this.getCurrentPosition()?this.STATES.PAUSE:this.STATES.STOP)},this),!1),this.audio.addEventListener("waiting",T.fn.bind(function(){this._firePlayStateChange(this.getCurrentPosition()?this.STATES.BUFFERING:this.STATES.PREBUFFER)},this),!1)}}),PlayEngine_FMP_MP3=mbox.lang.createClass(function(t){t=t||{},this.supportMimeType=["mp3"],this.engineType="fmp_mp3",this.swfPath="fmp_mp3.swf",this.flashVersionRequire=t.flashVersionRequire||"9.0.0",this.versionErrorMessage=t.versionErrorMessage||"",this.stateCode={"-2":this.STATES.INIT,"-1":this.STATES.READY,0:this.STATES.STOP,1:this.STATES.PLAY,2:this.STATES.PAUSE,3:this.STATES.END,4:this.STATES.BUFFERING,5:this.STATES.PREBUFFER,6:this.STATES.ERROR},this.flashLoaded=!1,this.flashReady=new mbox.Fuze},{superClass:PlayEngine_Interface,className:"PlayEngine_FMP_MP3"}).extend({test:function(t){return this._checkPlayer(t)},init:function(t){t=t||{};var e=t.el;this.instanceName=t.instanceName,this.swfPath=t.swfPath||this.swfPath;var i,n=this.newId();T.lang.isString(e)&&(e=T.g(e)),e||(e=T.dom.create("div"),document.body.appendChild(e)),i=T.dom.create("div"),e.appendChild(i),this.swfPath+="?"+n+"_"+Math.random(),T.swf.create({id:this.flashObjectId=n,width:"1px",height:"1px",ver:this.flashVersionRequire,errorMessage:this.versionErrorMessage,allowscriptaccess:"always",url:this.swfPath,bgcolor:"#ffffff",wmode:"window",scale:"noscale",vars:{_instanceName:this.instanceName+"",_buffertime:2e3}},i),this.flashObject=T.swf.getMovie(this.flashObjectId)},reset:function(){this.stop(),this.state!=this.STATES.INIT&&(this.url="",this.state=this.STATES.READY,this.stateStack=[this.STATES.READY])},setUrl:function(t){this.flashReady(T.fn.bind(function(){this.url=t,this.flashObject.closeStream(),this.flashObject.f_load(t)},this))},play:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PLAY&&this.flashObject.f_play()},this))},pause:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PAUSE&&this.state!=this.STATES.STOP&&this.state!=this.STATES.END&&this.flashObject.f_pause()},this))},stop:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.STOP&&this.flashObject.f_stop()},this))},setMute:function(t){this.flashReady(T.fn.bind(function(){this.mute=t,this.flashObject.setData("mute",t)},this))},setVolume:function(t){this.flashReady(T.fn.bind(function(){this.volume=t,this.flashObject.setData("volume",t)},this))},setCurrentPosition:function(t){this.flashReady(T.fn.bind(function(){this.flashObject.f_play(t)},this))},getCurrentPosition:function(){return this.flashLoaded?this.flashObject.getData("currentPosition"):0},getLoadedPercent:function(){return this.flashLoaded?this.flashObject.getData("loadedPct"):0},getTotalTime:function(){return this.flashLoaded?this.flashObject.getData("length"):0},getState:function(t){return T.lang.isNumber(t)?this.stateCode[t]:this.state},getVersion:function(){return T.swf.version},_firePlayStateChange:function(t){if(this.state!=t){this.state=t,this.stateStack.push(t);var e=this.stateStack.shift();this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:e,engineType:this.engineType})}},_onLoad:function(){this.state=this.STATES.READY,this.stateStack=[this.state],this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.flashObject}),setTimeout(T.fn.bind(function(){this.flashReady.fire(),this.flashLoaded=!0},this),0)},_onPlayStateChange:function(t){setTimeout(T.fn.bind(function(){this._firePlayStateChange(this.getState(t))},this),0)},_checkPlayer:function(t){t=!!t;var e=T.swf.version,i=this.flashVersionRequire;if(e){var n=e.split("."),s=i.split(".");return n[0]-s[0]>=0&&n[1]-s[1]>=0?!0:(t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1)}return t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1}}),PlayEngine=mbox.lang.createClass(function(t){t=t||{},this.subEnginesConf=[],this.subEnginesInitArgs={},this.curEngine=null,this.curEngineType="",this.unInitEngineList=[],this.engineList=[],this.engineTypeList=[],this.ready=!1,this.defaultExt=".mp3",this.coreContainer=null,this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.progressTimer=new mbox.Timer(200,0),this.positionTimer=new mbox.Timer(100,0),this._initEngines(t)},{className:"PlayEngine"}).extend({_error:function(t){throw new Error(t)},_initEngines:function(config){this.coreContainer=config.el||null,this.subEnginesConf=config.subEngines||[],T.array.each(this.subEnginesConf,T.fn.bind(function(item,index){var subEngineName=item.constructorName,args=item.args||{},subEngineConstructor;this.subEnginesInitArgs[subEngineName]=args;try{if(subEngineConstructor=eval(subEngineName),!T.lang.isFunction(subEngineConstructor))return}catch(e){return}var engine=new subEngineConstructor(args);this.unInitEngineList.push(engine)},this)),this.curEngine=this.unInitEngineList[0]},init:function(t){if(this.ready)return this._error("");if(t=t||{},this.subEnginesInitArgs=t.subEngines?t.subEngines:this.subEnginesInitArgs,this.coreContainer=t.el?t.el:this.coreContainer,!this.coreContainer){var e=T.dom.create("div",{id:"_player_container_"+T.lang.guid()});T.dom.setStyles(e,{width:"1px",height:"1px",overflow:"hidden"}),document.body.appendChild(e),this.coreContainer=t.el=e}T.array.each(this.unInitEngineList,T.fn.bind(function(t){var e=t.toString(),i="",n=/^\[object (.*)\]$/i;n.test(e)&&(i=RegExp.$1);var s=this.subEnginesInitArgs[i]||{};t.test(!0)&&(s.instanceName=s.instanceName+".engineList["+this.engineList.length+"]",s.el=s.el||this.coreContainer,this.engineList.push(t),t.init.apply(t,[s]))},this)),this.switchEngineByUrl(this.defaultExt),this.ready=!0,this._initProgressEvent(),this._initPositionChangeEvent()},canPlayType:function(t){return T.array.some(this.engineList,function(e){return e.canPlayType(t)})},getSupportMimeTypeList:function(){var t=[];return T.array.each(this.engineList,T.fn.bind(function(e){t=t.concat(e.getSupportMimeTypeList())},this)),t},switchEngineByUrl:function(t){var e=T.array.some(this.engineList,T.fn.bind(function(e){var i=e.getSupportMimeTypeList().join("|"),n=new RegExp("\\.("+i+")(\\?|$)","ig");return n.test(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this)),i=arguments[1];e||i||arguments.callee.apply(this,[this.defaultExt,!0])},switchEngineByMimeType:function(t){T.array.some(this.engineList,T.fn.bind(function(e){return e.canPlayType(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this))},reset:function(){this.curEngine.reset.apply(this.curEngine,arguments)},setUrl:function(t){var e=this.curEngine;this.switchEngineByUrl(t),e&&e!=this.curEngine&&e.stop(),this.curEngine&&this.curEngine.setUrl.apply(this.curEngine,arguments)},getUrl:function(){return this.curEngine.getUrl.apply(this.curEngine,arguments)},play:function(t){return"undefined"!=typeof t?this.setCurrentPosition(t):this.curEngine?this.curEngine.play.apply(this.curEngine,arguments):void 0},pause:function(){return this.curEngine?this.curEngine.pause.apply(this.curEngine,arguments):void 0},stop:function(){return this.curEngine?this.curEngine.stop.apply(this.curEngine,arguments):void 0},setMute:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setMute.apply(e,t)})},getMute:function(){return this.curEngine?this.curEngine.getMute.apply(this.curEngine,arguments):!1},setVolume:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setVolume.apply(e,t)})},getVolume:function(){return this.curEngine?this.curEngine.getVolume.apply(this.curEngine,arguments):0},setCurrentPosition:function(){return this.curEngine?this.curEngine.setCurrentPosition.apply(this.curEngine,arguments):void 0},getCurrentPosition:function(){return this.curEngine?this.curEngine.getCurrentPosition.apply(this.curEngine,arguments):0},getCurrentPositionString:function(){return mbox.convertTime(this.getCurrentPosition())},getLoadedPercent:function(){return this.curEngine?this.curEngine.getLoadedPercent.apply(this.curEngine,arguments):0},getLoadedBytes:function(){return this.curEngine?this.curEngine.getLoadedBytes.apply(this.curEngine,arguments):void 0},getTotalBytes:function(){return this.curEngine?this.curEngine.getTotalBytes.apply(this.curEngine,arguments):0},getTotalTime:function(){return this.curEngine?this.curEngine.getTotalTime.apply(this.curEngine,arguments):0},getTotalTimeString:function(){return mbox.convertTime(this.getTotalTime())},getCurEngine:function(){return this.curEngine},getEngineType:function(){return this.getCurEngine().getEngineType()},getVersion:function(){var t={};return T.array.each(this.engineList,function(e){t[e.getEngineType()]=e.getVersion()}),t},getState:function(){return this.curEngine?this.curEngine.getState.apply(this.curEngine,arguments):null},setEventListener:function(t,e,i){var n;n=t==this.EVENTS.INITFAIL||t==this.EVENTS.INIT?T.fn.bind(function(){e.apply(this,arguments)},this):T.fn.bind(function(t){t.target&&t.target.getEngineType()==this.curEngineType&&e.apply(this,arguments)},this),T.array.each(this.unInitEngineList,function(e){e.setEventListener(t,n,i)
})},removeEventListener:function(t,e){T.array.each(this.unInitEngineList,function(i){i.removeEventListener(t,e)})},_initProgressEvent:function(){this.progressTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getLoadedPercent();this.curEngine.dispatchEvent(this.EVENTS.PROGRESS,{progress:t,totalBytes:this.getTotalBytes(),loadedBytes:this.getLoadedBytes(),totalTime:this.getTotalTime()}),1==t&&"wmp"!=this.curEngineType&&this.progressTimer.stop()},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PREBUFFER:case this.STATES.PLAY:this.getLoadedPercent()<1&&this.progressTimer.start();break;case this.STATES.STOP:case this.STATES.READY:case this.STATES.END:this.progressTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.progressTimer.reset(),this.progressTimer.start()},this))},_initPositionChangeEvent:function(){this.positionTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getCurrentPosition();this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:t})},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PLAY:this.positionTimer.start();break;case this.STATES.STOP:case this.STATES.PAUSE:this.positionTimer.pause(),this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:this.getCurrentPosition()});break;case this.STATES.READY:case this.STATES.END:this.positionTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.positionTimer.reset()},this))}});mbox.SongModel=function(t){t=t||{},this.hasLink=!1,this.songId=0,this.songName="",this.artistId=0,this.artistName="",this.albumId=0,this.albumName="",this.songPicSmall="",this.songPicBig="",this.songPicRadio="",this.lrcLink="",this.time=0,this.songLink="",this.showLink="",this.format="",this.rate=0,this.size=0,this.lyricContent="",this.relateStatus=0,this.resourceType=0,this.copyType=0;for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},mbox.SongModel.prototype={set:function(t){for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},get:function(t){return this[t]},unset:function(t){delete this[t]}},function(){var t=T.lang.createClass(function(){this.allSongCache={},this.apiAddress=mbox.CONF.songLinkHost.link,this.lrcAddress=mbox.CONF.songLinkHost.lrc,this.sugAddress=mbox.CONF.songLinkHost.sug}).extend({createSongModel:function(t,e){var i=[],t=T.lang.toArray(t),e=T.lang.toArray(e);return T.each(t,function(t){t&&"null"!==t&&"undefined"!==t&&(this.allSongCache[t]||(this.allSongCache[t]=new mbox.SongModel({songId:t})),i.push(this.allSongCache[t]))},this),T.object.each(e,function(t){this.allSongCache[t.queryId||t.id]&&this.allSongCache[t.queryId||t.id].set(t)},this),i},fetchIdByQuery:function(t,e){var i=t.split("$$"),n=i[0]||i[2],s=i[1];T.sio.callByServer(this.sugAddress+n+" "+s,function(i){i.song_list&&i.song_list.length?e(i.song_list[0].song_id):e(t)})},fetchSong:function(t,e){t.hasLink?T.lang.isFunction(e.success)&&e.success(t,this):t.songId.toString().indexOf("$$")>-1?this.fetchIdByQuery(t.songId,T.fn.bind(function(i){T.sio.callByServer(this.apiAddress+i,function(i){if(22e3===i.error_code){var n=i.songinfo,s=i.bitrate;if(n.extra){var a=n.extra.split("$$");n.song_id=n.extra,n.title=a[0]||a[2],n.author=a[1]}t.set({hasLink:!0,songId:n.song_id,songName:n.title,artistId:n.ting_uid,artistName:n.author,albumId:n.album_id,albumName:n.album_title,songPicBig:n.pic_big,songPicSmall:n.pic_small||"http://mu9.bdstatic.com/player/t/i/JJn494Tv.jpg",songPicRadio:n.pic_radio,resourceType:n.resource_type,relateStatus:n.relate_status,copyType:n.copy_type,lrcLink:n.lrclink,rate:s.file_bitrate,songLink:s.file_link,showLink:s.show_link,format:s.file_extension,size:s.file_size,time:s.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,i.error_code)})},this)):T.sio.callByServer(this.apiAddress+t.songId,function(i){if(22e3===i.error_code){var n=i.songinfo,s=i.bitrate;if(n.extra){var a=n.extra.split("$$");n.song_id=n.extra,n.title=a[0]||a[2],n.author=a[1]}t.set({hasLink:!0,songId:n.song_id,songName:n.title,artistId:n.ting_uid,artistName:n.author,albumId:n.album_id,albumName:n.album_title,songPicBig:n.pic_big,songPicSmall:n.pic_small||"http://mu9.bdstatic.com/player/t/i/JJn494Tv.jpg",songPicRadio:n.pic_radio,resourceType:n.resource_type,relateStatus:n.relate_status,copyType:n.copy_type,lrcLink:n.lrclink,rate:s.file_bitrate,songLink:s.file_link,showLink:s.show_link,format:s.file_extension,size:s.file_size,time:s.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,i.error_code)})},getLrcContent:function(t,e){var i=T.lang.isFunction,n=i(e)?e:i(e.success)?e.success:function(){},s=i(e.error)?e.error:function(){};t.lrcContent?n(t.lrcContent):t.songLink&&t.lrcLink?T.sio.callByServer(this.lrcAddress+t.songId,function(e){e.lrcContent?(t.lrcContent=e.lrcContent,n(e.lrcContent)):s()}):s()}});mbox.SongDataModel=new t}(void 0),function(){var t={RANDOM:0,SINGLE:1,CYCLE:2};mbox.PlayList=T.lang.createClass(function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.mode=t.SINGLE}).extend({_random:function(){return parseInt(Math.random()*this.getLength(),10)},addSong:function(t){t=T.lang.toArray(t),t.length&&(this.songModels=this.songModels.concat(t),this.dispatchEvent("add:songModels",{songModels:t}))},removeSong:function(t){if(-1===t)this.reset(),this.dispatchEvent("remove:songModels",{indexes:e});else{var e=T.lang.toArray(t),i=e.length;if(i){e.sort(function(t,e){return t-e});for(var n=this.curSongIndex,s=n,a=!1;i--;){var r=e[i];this.songModels.splice(r,1),-1!==s&&(r===n&&(a=!0),n>=r&&n--)}a&&n++,-1!==s&&(0>n&&songlist.length>0?(n=0,a=!0):n>songlist.length-1&&(n=0)),a&&(this.curSong=songlist[n],this.curSongIndex=n),this.dispatchEvent("remove:songModels",{indexes:e})}}},prev:function(){var e=this.getLength(),i=-1===this.curSongIndex?0:(this.curSongIndex+e-1)%e;e&&(this.mode===t.RANDOM?this.setCurIndex(this._random()):this.setCurIndex(i))},next:function(){var e=this.getLength(),i=(this.curSongIndex+1)%e;e&&(this.mode===t.RANDOM?this.setCurIndex(this._random()):this.setCurIndex(i))},autoNext:function(){this.mode===t.SINGLE?this.setCurIndex(this.curSongIndex):this.next()},setCurIndex:function(t){this.curSongIndex=t,this.setCurSong(this.songModels[t]),this.dispatchEvent("change:curSongIndex",{index:t})},setCurSong:function(t){this.curSong=t,this.dispatchEvent("change:curSong",{curSong:t})},getCurIndex:function(){return this.curSongIndex},getCurSong:function(){return this.curSong},getSongList:function(){return this.songModels},setMode:function(t){this.mode=t},getMode:function(){return this.mode},getLength:function(){return this.songModels.length},reset:function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.playlist=[]},fetchLink:function(t){mbox.SongDataModel.fetchSong(this.curSong,t)}})}(),mbox.LogModel=T.lang.createClass(function(t,e){this.logUrl="http://nsclick.baidu.com/v.gif",this.playerRules={},this.playerRuleCtrl=null,this.player=t,this.playList=e,this.initLog()}).extend({initLog:function(){{var t=this;new mbox.PlayerLog({time:100,resetOnNoVoice:!0,type:"play100ms",player:this.player,handler:function(){t.sendLog("playsong100ms",t.logUrl,{sendCurSong:!0})}}),new mbox.PlayerLog({time:6e4,resetOnNoVoice:!1,type:"play60s",player:this.player,handler:function(){t.sendLog("60play",t.logUrl,{sendCurSong:!0})}})}this.player.setEventListener("setUrl",function(){t.sendLog("playstart",t.logUrl,{sendCurSong:!0})})},_addCurSong:function(t){var e={song_id:"songId",song_title:"songName",singer_id:"artistId",singer_name:"artistName",album_id:"albumId",album_name:"albumName",copytype:"copyType",format:"format",queryid:"queryId",rate:"rate",relatestatus:"relateStatus",resourcetype:"resourceType",songsize:"size",linkCode:"linkCode",lrcLink:"lrcLink",time:"time",status:"status",from:"from",link:"songLink"},i=this.playList.getCurSong();T.object.each(e,function(e,n){t.push(n+"="+encodeURIComponent(null==i[e]?"":i[e]))})},sendLog:function(t,e,i){var n=[],s=(new Date).getTime();window["naga_log_"+s]=new Image;var a=window["naga_log_"+s];n.push("pid=304"),n.push("url="),n.push("type="+t),i.sendCurSong&&this._addCurSong(n),i.pos&&n.push("pos="+i.pos),n.push("r"+Math.random()+"=1"),mbox.CONF.logOpt&&(mbox.CONF.logOpt.ref||(mbox.CONF.logOpt.ref="pc_aldsinglebox"),T.object.each(mbox.CONF.logOpt,function(t,e){n.push(e+"="+t)})),i.otherInfo&&_.each(i.otherInfo,function(t,e){n.push(e+"="+encodeURIComponent(t+""||""))}),a.onload=function(){a=null;try{delete window["naga_log_"+s]}catch(t){}},a.src=e+"?"+n.join("&")}}),mbox.PlayerLog=function(t){this.type=t.type,this.time=t.time,this.resetOnNoVoice=t.resetOnNoVoice,this.player=t.player,this.active=!1,this.timer=null,this.handlers=[],t.handler&&this.handlers.push(t.handler),this._init()},mbox.PlayerLog.prototype={_init:function(){this.timer||null==this.time||(this.timer=new mbox.Timer(this.time,1),this.addHandler(this.handler),this.timer.addEventListener("timer",T.fn.bind(function(){for(var t=0,e=this.handlers.length;e>t;t++)this.handlers[t]&&this.handlers[t].apply(this,arguments)},this)));var t=this.player.EVENTS.STATECHANGE,e=this.player.STATES;this.player.setEventListener("setUrl",T.fn.bind(function(){this.active=!0,this.timer.reset()},this)),this.player.setEventListener(t,T.fn.bind(function(t){this.active&&(t.newState==e.PLAY?this.timer.start():this.resetOnNoVoice?this.timer.reset():t.newState==e.PAUSE||t.newState==e.BUFFERING?t.oldState==e.PLAY&&this.timer.pause():this.timer.reset())},this))},addHandler:function(t){this.handlers.push(t)}},mbox.PlayCtrl=mbox.lang.createClass(function(t){var e=[],i=mbox.CONF.instanceCallName,n=mbox.CONF.engineArg;"object"!=typeof window[i]&&(window[i]={}),/(macintosh|iphone|ipod|ipad)/i.test(navigator.userAgent)?(e.push(n.audio),e.push(n.fmp)):(e.push(n.fmp),e.push(n.audio)),this.player=window[i].player=new PlayEngine({subEngines:e}),this.player.init(),this.curSong=null,this.playList=new mbox.PlayList,this.log=new mbox.LogModel(this.player,this.playList),window[i].logger=this.log,this._init(t),mbox.CONF.exportAPI&&(window[i][mbox.CONF.exportAPI]=this.exportAPI())}).extend({_init:function(t){t=t||{};var e=this.player,i=this.playList,n=t.songId||[],s=mbox.SongDataModel.createSongModel(n),a=this,r=T.lang.isFunction;t.logOpt&&T.object.extend(mbox.CONF.logOpt||{},t.logOpt),e.setEventListener(e.EVENTS.POSITIONCHANGE,function(e){var i=e.position,n=a.getTotalTime();r(t.onPositionChange)&&t.onPositionChange(i,100*i/n||0)}),r(t.onProgressChange)&&e.setEventListener(e.EVENTS.PROGRESS,function(e){t.onProgressChange(100*e.progress)}),e.setEventListener(e.EVENTS.STATECHANGE,function(n){switch(r(t.onPlayStateChange)&&t.onPlayStateChange(n.newState,n.oldState),n.newState){case e.STATES.END:mbox.CONF.autoNext?(i.autoNext(),a.play()):e.stop()}}),i.addEventListener("change:curSong",function(i){e.stop(),(a.curSong=i.curSong)?a.playList.fetchLink({success:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(e),a.dispatchEvent("fetch:link",{song:e})},error:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(null,e)}}):r(t.onChangeCurSong)&&t.onChangeCurSong(null)}),i.addSong(s),this.playList.setCurIndex(0),(void 0!==t.autoPlay?t.autoPlay:mbox.CONF.autoPlay)&&this.play()},getCurSong:function(){return this.curSong},getTotalTime:function(){return this.curSong&&1e3*this.curSong.time||this.player.getTotalTime()},setPlayIndex:function(t,e){this.playList.setCurIndex(t),e&&this.play()},play:function(){if(this.curSong&&this.curSong.songLink)this.curSong.songLink!==this.player.getUrl()&&(this.player.reset(),this.player.setUrl(this.curSong.songLink)),this.player.play();else{var t=this;this.addEventListener("fetch:link",function(e){if(!e.song)throw"fetch songLink fail";t.player.setUrl(e.song.songLink),t.player.play(),t.removeEventListener("fetch:link.link")},"link")}},pause:function(){this.player.pause()},stop:function(){this.player.stop()},exportAPI:function(){var t=this,e=this.player.EVENTS;return{getCurSong:function(){return t.curSong},getTotalTime:function(){return t.totalTime},getPlayerState:function(){return t.player.getState()},getPosition:function(){return t.player.getPosition()},getProgress:function(){return t.player.getProgress()},play:function(){t.play.apply(t,arguments)},pause:function(){t.pause()},stop:function(){t.stop()},listenToStateChange:function(i){t.player.setEventListener(e.STATECHANGE,i)},listenToPosChange:function(i){t.player.setEventListener(e.POSITIONCHAGNE,i)},listenToLoadedPercentChange:function(i){t.player.setEventListener(e.PROGRESS,i)},getCurIndex:function(){return t.playList.getCurIndex()},addSong:function(e){var i=T.lang.toArray(e);i.length&&"object"!=typeof i[0]&&(i=mbox.SongDataModel.createSongModel(i)),t.playList.addSong(i)},removeSong:function(e){t.playList.removeSong(e)},setPlayIndex:function(e,i){this.setPlayIndex.call(t,e,i)},setPlayMode:function(e){t.playList.setMode(e)}}}}),mbox.uiConf={prefix:"mbox",allWidget:["slider","time","volume","mute","title","lrc","album","playList","playBtn"],tpl:'<div class="mbox">                <div class="logo" ><a href="http://music.baidu.com" target="_blank" title="\u767E\u5EA6\u97F3\u4E50"></a></div>                <div class="player-main">                    <div class="album-pic mbox-album">                        <img class="pic" data-src="<%=songPicSmall%>"/>                    </div>                    <div class="right-wrapper">                        <div class="right-top">                            <div class="mbox-title player-title">                                <div class="song-name song-info" songid="<%=songId%>"><a href="http://music.baidu.com/song/<%=songId%>" target="_blank"><%=songName%></a></div>                                <span class="artist song-info">\u6B4C\u624B\uFF1A<span class="artist-name"><%var i =0, len = all_artist.length; for(;len -i; i++){%>                                    <a href="<%=all_artist_link[i]%>" target="_blank"><%=all_artist[i]%></a><%};%></span></span>                                <span class="album song-info">\u4E13\u8F91\uFF1A<span class="album-name"><a href="<%=albumLink%>" target="_blank"><%=albumName%></a></span></span>                                <span class="source song-info">\u6765\u6E90\uFF1A<span class="link-source"><a href="javascript:void(0)"></a></span></span>                                <div class="lrc"></div>                            </div>                            <div class="button-wrapper">                                <a class="button add-favour" href="javascript:void(0)" onclick="return false;" title="\u70B9\u51FB\u6536\u85CF"></a>                                <a class="button lrc-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u67E5\u770B\u5168\u90E8\u6B4C\u8BCD"></a>                                <a class="button download-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u4E0B\u8F7D\u6B4C\u66F2"></a>                                <a class="button go-to-listen-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u5F39\u51FA\u64AD\u653E"></a>                            </div>                        </div>                        <div class="bottom-bars">                            <div class="bottom-bars-item mbox-playBtn ctrl-btn stop"><a href="javascript:void(0)" onclick="return false;"></a></div>                            <div class="bottom-bars-item  progress "><div class="slider-wrapper mbox-slider"></div></div>                            <div class="bottom-bars-item mbox-time time"><%=curTime%>/<%=totalTime%></div>                            <div class="bottom-bars-item volume">                                <a class="volume-btn mbox-mute" href="javascript:void(0)" onclick="return false;"  title="">&nbsp</a>                                <div class="slider-wrapper mbox-volume"></div>                            </div>                        </div>                    </div>                </div>                </div>'},function(t){var e="undefined"==typeof module?t.baidu=t.baidu||{}:module.exports;e.template=function(e,n){var s=function(){if(!t.document)return i._compile(e);var n=document.getElementById(e);if(n){if(i.cache[e])return i.cache[e];var s=/^(textarea|input)$/i.test(n.nodeName)?n.value:n.innerHTML;return i._compile(s)}return i._compile(e)}(),a=i._isObject(n)?s(n):s;return s=null,a};var i=e.template;i.versions=i.versions||[],i.versions.push("1.0.6"),i.cache={},i.LEFT_DELIMITER=i.LEFT_DELIMITER||"<%",i.RIGHT_DELIMITER=i.RIGHT_DELIMITER||"%>",i.ESCAPE=!0,i._encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},i._encodeReg=function(t){return String(t).replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")},i._encodeEventHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\\\/g,"\\").replace(/\\\//g,"/").replace(/\\n/g,"\n").replace(/\\r/g,"\r")},i._compile=function(t){var e="var _template_fun_array=[];\nvar fn=(function(__data__){\nvar _template_varName='';\nfor(name in __data__){\n_template_varName+=('var '+name+'=__data__[\"'+name+'\"];');\n};\neval(_template_varName);\n_template_fun_array.push('"+i._analysisStr(t)+"');\n_template_varName=null;\n})(_template_object);\nfn = null;\nreturn _template_fun_array.join('');\n";return new Function("_template_object",e)},i._isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},i._analysisStr=function(t){var e=i.LEFT_DELIMITER,n=i.RIGHT_DELIMITER,s=i._encodeReg(e),a=i._encodeReg(n);return t=String(t).replace(new RegExp("("+s+"[^"+a+"]*)//.*\n","g"),"$1").replace(new RegExp("<!--.*?-->","g"),"").replace(new RegExp(s+"\\*.*?\\*"+a,"g"),"").replace(new RegExp("[\\r\\t\\n]","g"),"").replace(new RegExp(s+"(?:(?!"+a+")[\\s\\S])*"+a+"|((?:(?!"+s+")[\\s\\S])+)","g"),function(t,e){var i="";if(e)for(i=e.replace(/\\/g,"&#92;").replace(/'/g,"&#39;");/<[^<]*?&#39;[^<]*?>/g.test(i);)i=i.replace(/(<[^<]*?)&#39;([^<]*?>)/g,"$1\r$2");else i=t;return i}),t=t.replace(new RegExp("("+s+"[\\s]*?var[\\s]*?.*?[\\s]*?[^;])[\\s]*?"+a,"g"),"$1;"+n).replace(new RegExp("("+s+":?[hvu]?[\\s]*?=[\\s]*?[^;|"+a+"]*?);[\\s]*?"+a,"g"),"$1"+n).split(e).join("	"),t=i.ESCAPE?t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'"):t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':$1,'"),t=t.replace(new RegExp("\\t:h=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'").replace(new RegExp("\\t(?::=|-)(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':$1,'").replace(new RegExp("\\t:u=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':encodeURIComponent($1),'").replace(new RegExp("\\t:v=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':baidu.template._encodeEventHTML($1),'").split("	").join("');").split(n).join("_template_fun_array.push('").split("\r").join("\\'")}}(window),function(t,e){t.widget&&"function"===t.widget&&(t.box_widget=t.widget);var i=0,n=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(a){}s(e)},t.box_widget=function(e,i,n){var s,a,r,o,u=e.split(".")[0];e=e.split(".")[1],s=u+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s.toLowerCase()]=function(e){return!!t.data(e,s)},t[u]=t[u]||{},a=t[u][e],r=t[u][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new r(t,e)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),o=new i,o.options=t.box_widget.extend({},o.options),t.each(n,function(e,s){t.isFunction(s)&&(n[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=a,e}}())}),r.prototype=t.box_widget.extend(o,{widgetEventPrefix:e},n,{constructor:r,namespace:u,widgetName:e,widgetBaseClass:s,widgetFullName:s}),a?(t.each(a._childConstructors,function(e,i){var n=i.prototype;t.box_widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete a._childConstructors):i._childConstructors.push(r),t.box_widget.bridge(e,r)},t.box_widget.extend=function(i){for(var s,a,r=n.call(arguments,1),o=0,u=r.length;u>o;o++)for(s in r[o])a=r[o][s],r[o].hasOwnProperty(s)&&a!==e&&(i[s]=t.isPlainObject(a)?t.box_widget.extend({},i[s],a):a);return i},t.box_widget.bridge=function(i,s){var a=s.prototype.widgetFullName;t.fn[i]=function(r){var o="string"==typeof r,u=n.call(arguments,1),l=this;return r=!o&&u.length?t.box_widget.extend.apply(null,[r].concat(u)):r,o?this.each(function(){var n,s=t.data(this,a);return s?t.isFunction(s[r])&&"_"!==r.charAt(0)?(n=s[r].apply(s,u),n!==s&&n!==e?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):t.error("no such method '"+r+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+r+"'")}):this.each(function(){var e=t.data(this,a);e?e.option(r||{})._init():new s(r,this)}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.box_widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetName,this),t.data(n,this.widgetFullName,this),this._on({remove:"destroy"}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var s,a,r,o=i;if(0===arguments.length)return t.box_widget.extend({},this.options);if("string"==typeof i)if(o={},s=i.split("."),i=s.shift(),s.length){for(a=o[i]=t.box_widget.extend({},this.options[i]),r=0;r<s.length-1;r++)a[s[r]]=a[s[r]]||{},a=a[s[r]];if(i=s.pop(),n===e)return a[i]===e?null:a[i];a[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i){i?(e=t(e),this.bindings=this.bindings.add(e)):(i=e,e=this.element);var n=this;t.each(i,function(i,s){function a(){return n.options.disabled===!0||t(this).hasClass("ui-state-disabled")?void 0:("string"==typeof s?n[s]:s).apply(n,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var r=i.match(/^(\w+)\s*(.*)$/),o=r[1]+n.eventNamespace,u=r[2];u?n.widget().delegate(u,o,a):e.bind(o,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var s,a,r=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(s in a)s in i||(i[s]=a[s]);return this.element.trigger(i,n),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,a){"string"==typeof s&&(s={effect:s});var r,o=s?s===!0||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),r=!t.isEmptyObject(s),s.complete=a,s.delay&&n.delay(s.delay),r&&t.effects&&(t.effects.effect[o]||t.uiBackCompat!==!1&&t.effects[o])?n[e](s):o!==e&&n[o]?n[o](s.duration,s.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}}),t.uiBackCompat!==!1&&(t.Widget.prototype._getCreateOptions=function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.box_widget("ui.box_mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1==i.which,a="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return s&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){var e=5;t.box_widget("ui.box_slider",t.ui.box_mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",progressbar:!1,progress:0,constraintProgress:!1,range:!1,step:1,value:0,values:null},_create:function(){var i=this,n=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' hidefocus='true'><span></span></a>",r=n.values&&n.values.length||1,o=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":"")),this.range=t([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=t("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===n.range||"max"===n.range?" ui-slider-range-"+n.range:""))),n.progressbar&&(this.progressbar=t("<div></div>").appendTo(this.element).addClass("ui-slider-progressbar ui-widget-header"));for(var u=s.length;r>u;u+=1)o.push(a);this.handles=s.add(t(o.join("")).appendTo(i.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(t){t.preventDefault()}).hover(function(){n.disabled||t(this).addClass("ui-state-hover ui-slider-handle-hover")},function(){t(this).removeClass("ui-state-hover ui-slider-handle-hover")}).focus(function(){n.disabled?t(this).blur():(t(".ui-slider .ui-state-focus").removeClass("ui-state-focus ui-slider-handle-focus"),t(this).addClass("ui-state-focus ui-slider-handle-focus"))}).blur(function(){t(this).removeClass("ui-state-focus ui-slider-handle-focus")}),this.handles.each(function(e){t(this).data("index.ui-slider-handle",e)}),this.handles.keydown(function(n){var s,a,r,o,u=t(this).data("index.ui-slider-handle");if(!i.options.disabled){switch(n.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n.preventDefault(),!i._keySliding&&(i._keySliding=!0,t(this).addClass("ui-state-active ui-slider-handle-active"),s=i._start(n,u),s===!1))return}switch(o=i.options.step,a=r=i.options.values&&i.options.values.length?i.values(u):i.value(),n.keyCode){case t.ui.keyCode.HOME:r=i._valueMin();break;case t.ui.keyCode.END:r=i._valueMax();break;case t.ui.keyCode.PAGE_UP:r=i._trimAlignValue(a+(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:r=i._trimAlignValue(a-(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(a===i._valueMax())return;r=i._trimAlignValue(a+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(a===i._valueMin())return;r=i._trimAlignValue(a-o)}i._slide(n,u,r)}}).keyup(function(e){var n=t(this).data("index.ui-slider-handle");i._keySliding&&(i._keySliding=!1,i._stop(e,n),i._change(e,n),t(this).removeClass("ui-state-active ui-slider-handle-active"))}),this._refreshValue(),this._refreshProgress(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(e){var i,n,s,a,r,o,u,l,h,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,r=this,this.handles.each(function(e){var i=Math.abs(n-r.values(e));
s>i&&(s=i,a=t(this),o=e)}),d.range===!0&&this.values(1)===d.min&&(o+=1,a=t(this.handles[o])),u=this._start(e,o),u===!1?!1:(this._mouseSliding=!0,r._handleIndex=o,a.addClass("ui-state-active ui-slider-handle-active").focus(),l=a.offset(),h=!t(e.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active ui-slider-handle-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,s,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),a=this._valueMin()+n*s,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,s,a;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&(s=this.values(),s[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:s}),n=this.values(e?0:1),a!==!1&&this.values(e,i,!0))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("change",t,i)}},_progress:function(t){var e={progress:this.options.progress};this._trigger("progress",t,e)},progress:function(t){var e=this._trimAlignProgress(t);return arguments.length&&this.options.progress!=e?(this.options.progress=e,this._refreshProgress(),this._progress(null),this.options.constraintProgress&&this.value()>e&&this.value(e),void 0):this.options.progress},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var n,s,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,s=arguments[0],a=0;a<n.length;a+=1)n[a]=this._trimAlignValue(s[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var n,s=0;switch(t.isArray(this.options.values)&&(s=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover ui-slider-handle-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this._refreshProgress();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"progress":this._refreshProgress(),this._progress(null),this.options.constraintProgress&&this.options.value>this.options.progress&&(this._animateOff=!0,this.value(this.options.progress),this._animateOff=!1);break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._refreshProgress(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(!this.options.constraintProgress&&t>=this._valueMax())return this._valueMax();this.options.progressbar&&this.options.constraintProgress&&t>=this.options.progress&&(t=this.options.progress);var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_trimAlignProgress:function(t){return t<=this._valueMin()?this._valueMin():t>=this._valueMax()?this._valueMax():t},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,n,s,a,r=this.options.range,o=this.options,u=this,l=this._animateOff?!1:o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){e=(u.values(n)-u._valueMin())/(u._valueMax()-u._valueMin())*100,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",t(this).stop(1,1)[l?"animate":"css"](h,o.animate),u.options.range===!0&&("horizontal"===u.orientation?(0===n&&u.range.stop(1,1)[l?"animate":"css"]({left:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({width:e-i+"%"},{queue:!1,duration:o.animate})):(0===n&&u.range.stop(1,1)[l?"animate":"css"]({bottom:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({height:e-i+"%"},{queue:!1,duration:o.animate}))),i=e}):(n=this.value(),s=this._valueMin(),a=this._valueMax(),e=a!==s?(n-s)/(a-s)*100:0,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",this.handle.stop(1,0)[l?"animate":"css"](h,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({width:e+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-e+"%"},{queue:!1,duration:o.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({height:e+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-e+"%"},{queue:!1,duration:o.animate}))},_refreshProgress:function(){var t=this.options,e=this._valueMax(),i=t.progress,n=i/e*100;this.progressbar&&("horizontal"===this.orientation?this.progressbar.css({width:n+"%"}):this.progressbar.css({height:n+"%"}))},setLoading:function(t,e){var i;arguments.length<=1?(e=t,i=this.handle):i=this.handles.eq(t),i[e?"addClass":"removeClass"]("ui-slider-handle-loading")}}),t.extend(t.ui.box_slider,{version:"1.8.20"})}(jQuery),function(t){t.cutString=function(t,e,i){var n,s,a,r=t.length,o=0,u=0;for(s=0;r>s;s++)if(o+=t.charCodeAt(s)>128?2:1,o>e){n=t.substring(0,s-1)+"...";break}for(a=r;a>0;a--){if(s>=a||0===i)return n;if(u+=t.charCodeAt(s)>128?2:1,u>i)return n+=t.substring(a)}return t}}(jQuery),mbox.UiCtrl=mbox.lang.createClass(function(t,e){this.guid="mbox_ui_"+setTimeout(function(){},0),this.conf=e||mbox.uiConf,this.conf&&(this.widget={},this._init(t),this.EVENTS={POSITIONCHANGE:"ui_poschange",TOGGLEPLAY:"ui_toggleplay",VOLCHANGE:"ui_volchange",MUTECHANGE:"ui_mutechange"},this.volume=80,this.$root=$(t),this.active=!1)}).extend({_init:function(t){if(this.conf.tpl){for(var e=$(this.conf.tpl).appendTo(t||"body").css("display","none"),i=this.conf.allWidget,n=this.conf.prefix,s={},a=i.length-1;a>-1;a--){var r=e.find("."+n+"-"+i[a]),o=r.html();o=o&&o.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>"),s[i[a]]={dom:r,tpl:o}}this.conf.domJson=s,e.css("display","block"),this.$root=e}var u=this.conf.domJson;for(var l in u)if(u.hasOwnProperty(l))switch(l){case"slider":this._initSlider(u[l]);break;case"volume":this.widget[l]=$(u[l].dom).box_slider({animate:!0,max:100,min:0,orientation:"horizental",progressbar:!1,range:"min",value:80}).bind("slide",T.fn.bind(function(t,e){this.active&&this.fireVolChange(+e.value,0===+e.value)},this)).bind("slidestop",T.fn.bind(function(){this.active||this.widget.volume.box_slider("option","value",this.volume)},this));break;case"mute":var h=this;this.widget[l]=$(u[l].dom).click(function(){var t=$(this).hasClass("mute");h.fireVolChange(h.volume,!t)});break;case"title":case"time":case"playList":case"album":this.widget[l]=$(u[l].dom),this.widget[l].tpl=u[l].tpl;break;case"playBtn":this.widget[l]=$(u[l].dom).bind("click",T.fn.bind(function(){var t=this.widget.playBtn.hasClass("stop");this.dispatchEvent(this.EVENTS.TOGGLEPLAY,{isPlay:t})},this))}this.conf.tpl&&this.tplToHtml()},_initSlider:function(t){var e=t.maxValue||1e4;this.widget.slider=$(t.dom).box_slider({animate:175,max:e,min:0,orientation:"horizontal",progressbar:!0,progress:0,constraintProgress:!0,range:"min",value:0}),this.widget.slider.maxValue=e,this.widget.slider.sliding=!1;var i=this;this.widget.slider.bind("slidestart",function(){i.widget.slider.isSliding=!0}).bind("slidestop",function(t,e){i.widget.slider.isSliding=!1,i.dispatchEvent(i.EVENTS.POSITIONCHANGE,{percent:e.value/i.widget.slider.maxValue}),!i.active&&i.widget.slider.box_slider("option","value",0)})},tplToHtml:function(t,e,i,n){function s(t){$(e).delegate("."+t,"click",function(){n.sendLog("click",n.logUrl,{pos:i[t]})})}if(this.widget.title){var a=this.createSongFilter(t);a.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==a.songName?this.widget.title.removeClass("grey"):this.widget.title.addClass("grey"),this.widget.title.html(baidu.template(this.widget.title.tpl,a))}if(this.widget.lrc&&this.widget.lrc.lrc("setLrc",""),this.widget.album){this.widget.album.html(baidu.template(this.widget.album.tpl,t));var r=this.widget.album.find("img");if(!r[0].src){var o=r.attr("data-src");o&&r.attr("src",o)}}this.widget.time&&this.widget.time.html(baidu.template(this.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(0)}));for(var u in i)s(u)},fireVolChange:function(t,e){return this.active?(this.volume=t,e?(this.widget.mute&&this.widget.mute.addClass("mute").attr("title","\u53D6\u6D88\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",0)):(this.widget.mute&&this.widget.mute.removeClass("mute").attr("title","\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",this.volume)),this.dispatchEvent(this.EVENTS.VOLCHANGE,{volume:t}),this.dispatchEvent(this.EVENTS.MUTECHANGE,{mute:e}),!0):!1},setActive:function(t){this.active=t,this.$root[t?"addClass":"removeClass"]("active")},setShowLink:function(t,e){var i=t.showLink,n=i?$.cutString(i,16,5):"";("2"==t.resourceType.toString()||void 0===t.resourceType)&&($(e).find(".link-source a").text(n).attr("href",i),$(e).find(".source").show())},createSongFilter:function(t){var e,i,n=[],s=[],a=[];if(t){e="http://music.baidu.com/",n=t.artistId.toString().split(","),s=t.artistName.split(","),a=[];for(var r=0,o=s.length;o>r;r++)a[r]=n[r]?e+"artist/"+n[r]:"javascript:;";i={songId:t.songId,songName:t.songName||"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6",albumId:t.albumId,albumLink:t.albumId?e+"album/"+t.albumId:"javascript:;",albumName:t.albumName,all_artist:s,all_artist_id:n,all_artist_link:a}}else i={songId:"",songName:"",albumId:"",albumLink:"",albumName:"",all_artist:s,all_artist_id:n,all_artist_link:a};return i}}),function(){var t=function(t,e){if([].indexOf)return[].indexOf.call(t,e);for(var i=t.length-1;i>-1;i--)if(t[i]===e)return i;return-1};mbox.Controller=function(t){this.playctrl=t,this.uiList=[]},mbox.Controller.prototype={_init:function(){},bindUi:function(e,i){if(t(this.uiList,e)>-1||!e)return!1;if(i&&this.uiList.length>0)for(var n=this.uiList.length;n;n--)this.unbindUi(this.uiList[n-1]),this.uiList.splice(n-1,1);this.bindPlayerEvent(this.playctrl,e),this.bindSongInfoEvent(this.playctrl,e),this.bindPlayListEvent(this.playctrl,e),this.bindUIEvent(this.playctrl,e),this.uiList.push(e);var s=this.playctrl.player;return this._onPosition(e,s.getCurrentPosition()),this._onProgress(e,s.getLoadedPercent()),this._onState(e,s.getState()),e.setActive(!0),e.fireVolChange(e.volume,!e.volume),!0},unbindUi:function(t){var e,i=playctrl.player,n=t.guid,s=i.EVENTS,a=t.EVENTS;for(e in s)s.hasOwnProperty(e)&&i.removeEventListener(s[e]+"."+n);for(e in a)a.hasOwnProperty(e)&&t.removeEventListener(a[e]+"."+n);playctrl.removeEventListener("fetch:link."+n),t.setActive(!1)},bindPlayListEvent:function(){},bindPlayerEvent:function(t,e){var i=t.player,n=e.guid;i.setEventListener(i.EVENTS.POSITIONCHANGE,T.fn.bind(function(t){this._onPosition(e,t.position)},this),n),i.setEventListener(i.EVENTS.PROGRESS,T.fn.bind(function(t){this._onProgress(e,t.progress)},this),n),i.setEventListener(i.EVENTS.STATECHANGE,T.fn.bind(function(t){this._onState(e,t.newState)},this),n)},bindSongInfoEvent:function(t,e){t.addEventListener("fetch:link",T.fn.bind(function(t){this._onSongInfo(e,t.song)},this),e.guid)},bindUIEvent:function(t,e){var i=t.player;e.addEventListener(e.EVENTS.POSITIONCHANGE,function(e){i.setCurrentPosition(t.getTotalTime()*e.percent)},e.guid),e.addEventListener(e.EVENTS.VOLCHANGE,function(t){i.setVolume(t.volume)},e.guid),e.addEventListener(e.EVENTS.TOGGLEPLAY,function(e){t.player[e.isPlay?"play":"pause"]()},e.guid),e.addEventListener(e.EVENTS.MUTECHANGE,function(t){i.setMute(t.mute)},e.guid)},_onSongInfo:function(t,e){if(t.widget.title){var i=t.createSongFilter(e);i.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==i.songName?t.widget.title.removeClass("grey"):t.widget.title.addClass("grey"),t.widget.title.html(baidu.template(t.widget.title.tpl,i))}if(t.widget.lrc&&e&&mbox.SongDataModel.getLrcContent(e,{success:function(e){t.widget.lrc.lrc("setLrc",e)},error:function(){t.widget.lrc.lrc("setLrc","")}}),t.widget.album){t.widget.album.html(baidu.template(t.widget.album.tpl,e));var n=t.widget.album.find("img");if(!n[0].src){var s=n.attr("data-src");s&&n.attr("src",s)}}if(t.widget.time){var a=this.playctrl.getTotalTime();t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(a)}))}},_onPosition:function(t,e){var i=this.playctrl.getTotalTime();t.widget.slider&&!t.widget.slider.isSliding&&t.widget.slider.box_slider("option","value",e*t.widget.slider.maxValue/i||0),t.widget.lrc&&t.widget.lrc.lrc("scrollTo",e),t.widget.time&&t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(e),totalTime:mbox.convertTime(i)}))},_onProgress:function(t,e){t.widget.slider&&!t.widget.slider.sliding&&t.widget.slider.box_slider("progress",e*t.widget.slider.maxValue)},_onState:function(t,e){if(t.widget.playBtn){var i=this.playctrl.player;playing=e===i.STATES.PLAY||e===i.STATES.PREBUFFER||e===i.STATES.BUFFERING,playing?t.widget.playBtn.removeClass("stop"):t.widget.playBtn.addClass("stop")}}}}(window);
;_.Module.define({path:"pcommon/widget/MusicPlayer",requires:[],sub:{initial:function(t,i){window.playctrl||(window.playctrl=new window.mbox.PlayCtrl),this.api=window.playctrl.exportAPI(),this.log=window.playctrl.log,this.controller=new window.mbox.Controller(window.playctrl),this.logList={"song-name a":"song_title","artist-name a":"artist_name","album-name a":"album_name",logo:"logo","lrc-btn":"lrc","download-btn":"download","go-to-listen-btn":"to_musicbox"},this.ui=[];for(var o=0;o<t.length;o++)this.mboxInit(i[o],t[o],o);this.eventInit()},mboxInit:function(t,i,o){var n=this.ui,e=this.logList,a=this.log,l=this.api,s=this.controller;if(n[o]=new window.mbox.UiCtrl($(t)),"object"!=typeof i){var r=window.mbox.SongDataModel.createSongModel(i);window.mbox.SongDataModel.fetchSong(r[0],{success:function(i){n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t)}})}else 1!=i.hasLink&&(i={hasLink:!0,songId:i.song_id,songName:i.title,artistId:i.ting_uid,artistName:i.author,albumId:i.album_id,albumName:i.album_title,songPicBig:i.pic_big,songPicSmall:i.pic_small,songPicRadio:i.pic_radio,resourceType:i.resource_type,relateStatus:i.relate_status,copyType:i.copy_type,lrcLink:i.lrclink,rate:i.file_bitrate,songLink:i.file_link,showLink:i.show_link,format:i.file_extension,size:i.file_size,time:i.file_duration}),n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t);l.addSong(i),$(t).find(".ctrl-btn").click(function(){function t(t){return function(){s.bindUi(n[t],!0),l.setPlayIndex(t,!0)}}if(!n[o].$root.hasClass("active")){window.playctrl.player.stop();var i=t(o);setTimeout(i,100)}})},eventInit:function(){$(document).delegate(".add-favour","click",function(){var t=this,i=$(this).parents(".right-top").find($(".song-name")).tbattr("songid"),o="http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.favorite.addSongFavorite&from=tieba";$.getJSON(o+"&callback=?",{songId:i},function(i){var o=i.error_code;22e3===o||22322===o?$(t).addClass("add-favour-red"):22452===o&&_.Module.use("pcommon/widget/LoginDialog",["",""])})}).delegate(".lrc-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"#song_lyric")}).delegate(".download-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"/download")}).delegate(".go-to-listen-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com//box?&&__methodName=mboxCtrl.playSong&__argsValue="+t)})}}});_.Module.define({path:"ppb/widget/NoAutoVideo",requires:["pcommon/widget/MusicPlayer"],sub:{POST_WIDTH:565,_configs:{},initial:function(e){null!=e&&(this._configs=$.extend(this._configs,e)),this.postWrapper=$("#j_p_postlist"),this.videoElem=null,this.run()},run:function(){this._delMusic(),this._delFlash()},_getSearch:function(e){return e.replace(/http:\/\/box\.baidu\.com\/widget\/flash\/bdspacesong\.swf\?/g,"")},_getSearchValue:function(e,a){var t=a.replace(/^\?/,""),i={};if(!t)return void 0===e?i:void 0;t=t.split("&amp;");for(var o,r=0,s=t.length;s>r;r++)o=t[r].indexOf("="),o>0?i[t[r].substring(0,o)]=t[r].substring(o+1):i[t[r]]="";return void 0===e?i:i[e]},_delMusic:function(){var e=this.postWrapper.find(".BDE_Music"),a=this;"undefined"==typeof window._musiccount&&(window._musiccount=0),$.each(e,function(e,t){var i=$(t).tbattr("src"),o=a._getSearch(i),r=a._getSearchValue("song_id",o);if(r){var s=$('<div class="musicbox_con"></div>');$(t).replaceWith(s),a.musicPlayer?a.musicPlayer.mboxInit(s,r,_musiccount):(a.musicPlayer=a.use("pcommon/widget/MusicPlayer",[],[]),a.musicPlayer.mboxInit(s,r,_musiccount)),_musiccount++}else{i=i.replace(/autoplay=false/gi,"autoPlay=true");var n=$('<img style="cursor:pointer;display:block;" src="http://tb2.bdstatic.com/tb/static-ppb/img/no_music_auto.png">');$(t).replaceWith(n),n.bind("click",function(){var e=a._genericMusicImage(i);$(this).fadeOut(100,function(){$(this).replaceWith(e)})})}})},_genericMusicImage:function(e){var a='<embed width="402" height="95" class="BDE_Music" src="'+e+'" scale="noborder" allowscriptaccess="never" menu="false" loop="false" play="true" wmode="transparent" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" allowfullscreen="true" style="display:block;">';return $(a)},_delFlash:function(){var e=this,a=this.postWrapper.find(".BDE_Flash");if(!(a.length<1)){var t=!0;$.each(a,function(a,i){var o=$(i);if("voteFlash"==$(i).tbattr("id"))return!0;if(0==a&&1==e._configs.can_auto_play&&1==PageData.pager.cur_page){$.stats.track("\u9996\u697C\u64AD\u653E","\u5E73\u53F0\u5316\u9996\u697C\u89C6\u9891\u64AD\u653E\u7EDF\u8BA1");var r=o.parents(".l_post").data("field"),s=r&&r.content&&1==r.content.post_no;if(s)return o.css("display","block"),!0}var n=e._gettbattrs(i),c=(n.vsrc,n.duration?n.duration:""),l=n.video_from?n.video_from:"",p=!1;if(1===PageData.thread.is_ad&&t){var d=$(i).parents("div.l_post"),u=d.getData();1==u.content.floor||2==u.content.floor?p=!0:t=!1}e.videoElem=p?e._getAdReplaceElem():e._getReplaceElem(n,c,l),$(i).replaceWith(e.videoElem),e._bindPlayEvent(n)})}},_getReplaceElem:function(e,a,t){var i,o=e.vpic,r=this;return o||(o="http://tb2.bdstatic.com/tb/static-ppb/widget/no_auto_video/img/video_default_background_fdda8ae.png"),i=r._getVideoPic(o,a,t,e)},_getVideoPic:function(e,a,t,i){var o=i.width,r=i.height,s=280/210,n=o/r,c="";n>s?(r=210,o=r*n,c="margin-left: -"+(o-280)/2+"px;"):(o=280,r=o/n,c="margin-top: -"+(r-210)/2+"px;");var l='<div class="video_src_wrap_main"><div class="vpic_wrap"><img class="vpic_img"  style="width:'+o+"px;height:"+r+"px; "+c+'" src="'+e+'"/><span class="vpic_play"></span></div>',p='<div class="video_src_info"><div class="video_src_info_name" >'+t+'</div><div class="video_src_info_duration" >'+a+"</div></div></div>",d=$(l+p);return d},_getAdReplaceElem:function(){var e=$(document.createElement("div"));e.tbattr({id:"ad_video_area","class":"ad_video_area"});var a=$('<div class="ad_video_bg"></div>');a.css({background:"url('"+(PageData.thread.video_url||"")+"')"});var t=$('<div class="ad_play_btn"></div>');return e.append(a).append(t).append($('<div class="ad_play_bar"></div>')),e.hover(function(){t.css({"background-position":"0 -64px"})},function(){t.css({"background-position":"0 0"})}),e.bind("click",function(){if(document.images){var e=new Image;e.src="http://bzclk.baidu.com/video.php?page=pb&forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&t="+(new Date).getTime(),e=null}}),e},_gettbattrs:function(e){var a={};if(a.src=$(e).tbattr("src"),a.width=$(e).tbattr("width"),a.height=$(e).tbattr("height"),a.scale=$(e).tbattr("scale"),a.allowscriptaccess=$(e).tbattr("allowscriptaccess"),a.menu=$(e).tbattr("menu"),a.loop=$(e).tbattr("loop"),a.play=$(e).tbattr("play"),a.wmode=$(e).tbattr("wmode"),a.type=$(e).tbattr("type"),a.pluginspage=$(e).tbattr("pluginspage"),a.allowfullscreen=$(e).tbattr("allowfullscreen"),a.flashvars="playMovie=true&auto=1&adss=0&isAutoPlay=true",a.vsrc=$.tb.escapeHTML($(e).tbattr("vsrc")||""),a.vpic=$.tb.escapeHTML($(e).tbattr("vpic")||""),a.duration=$.tb.escapeHTML($(e).tbattr("duration")||""),a.video_from=$.tb.escapeHTML($(e).tbattr("video_from")||""),a.vhsrc=$.tb.escapeHTML($(e).tbattr("vhsrc")||""),a.videoType=$(e).tbattr("videoType"),a.tmplId=$(e).tbattr("templateId"),a.width>this.POST_WIDTH){var t=a.width/a.height;a.show_height=this.POST_WIDTH/t,a.show_width=this.POST_WIDTH}else a.show_width=a.width,a.show_height=a.height;return a},_bindPlayEvent:function(e){var a=this,t=a.videoElem;if(6===+e.videoType&&document.createElement("video").canPlayType)t.bind("click",function(){var t=a._createTponitVideoTagForH5Browser(e),i=t;$(this).html(i),a._bindTponitVideoEvent(e)});else if($.browser.msie)t.bind("click",function(){var t,i=e.src.match(/[\w]+\.[\w]+(?=\/)/i)[0];t=null!=i&&i.indexOf("cntv")>=0?$(a._createVideoTagForOtherBrowser(e)):$(a._createVideoTagForIEBrowser(e)),$(this).replaceWith($(t)),$(t).css("display","block")});else if("\u767E\u5EA6\u8D34\u5427"===e.video_from&&document.createElement("video").canPlayType){var i=a._createVideoTagForH5Browser(e),o=i;t.html(o)}else t.bind("click",function(){a._createVideoTagForOtherBrowser(e);$(this).replaceWith($(o)),$(o).css("display","block")})},_createVideoTagForH5Browser:function(e){var a,t=this,i=e.src,o=e.show_width,r=e.show_height,s=$.tb.unescapeHTML(i),n=e.vhsrc,c=$.tb.unescapeHTML(n);if(c){var l=/\/(tieba\-[a-zA-Z].*?)\/([a-zA-Z0-9_].*?)\.mp4/,p=c.match(l),d=p[1],u=p[2];a=u.split("_")[2],d&&u&&(u="http://tb-video.bdstatic.com/"+d+"/"+u+".mp4")}else{var h=new RegExp("(^|&)video=([^&]*)(&|$)"),p=s.match(h),u=p[2];a=u.split("_")[2],u&&(u="http://tb-video.bdstatic.com/tieba-smallvideo/"+u+".mp4")}mediaBoxHtml='<video style="width: '+o+"px; height: "+r+'px; background: #000;" src="'+u+'"controls="controls" autoplay="true"></video>';var m=location.pathname.split("/")[2];return t._sendLog(m,a,1),mediaBoxHtml},_createTponitVideoTagForH5Browser:function(e){{var a=this,t=e.src,i=e.show_width,o=e.show_height;$.tb.unescapeHTML(t)}mediaBoxHtml='<video class="tp-video"style="width: '+i+"px; height: "+o+'px; background: #000;" src="'+t+'"controls="controls" autoplay="true"></video>';var r=location.pathname.split("/")[2];return a._sendLog(r,null,2),mediaBoxHtml},_createVideoTagForOtherBrowser:function(e){var a=this,t=new Array;t.push('<embed type="'+e.type+'" '),t.push(' class="BDE_Flash"'),t.push(' src="'+e.src+'"'),t.push(' width="'+e.show_width+'"'),t.push(' height="'+e.show_height+'"'),t.push(' scale="'+e.scale+'"'),t.push(' allowscriptaccess="never"'),t.push(' menu="'+e.menu+'"'),t.push(' loop="'+e.loop+'"'),t.push(' play="true"'),t.push(' womode="'+e.wmode+'"'),t.push(' pluginspage="'+e.pluginspage+'"'),t.push(' allowfullscreen="true"'),t.push(' flashvars="'+e.flashvars+'"'),t.push(' style="visibility:visible;">'),t.push("</embed>");var i=location.pathname.split("/")[2];return a._sendLog(i,null,2),t.join("")},_createVideoTagForIEBrowser:function(e){var a=this,t='<object style="visibility:visible" class="BDE_Flash" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,22,0" width="'+e.show_width+'" height="'+e.show_height+'">',i=new Array;i.push('<param name="FlashVars" value="'+e.flashvars+'">'),i.push('<param name="Movie" value="'+e.src+'">'),i.push('<param name="Src" value="'+e.src+'">'),i.push('<param name="WMode" value="Transparent">'),i.push('<param name="Play" value="0">'),i.push('<param name="Loop" value="-1">'),i.push('<param name="Quality" value="High">'),i.push('<param name="Menu" value="0">'),i.push('<param name="AllowScriptAccess" value="never">'),i.push('<param name="Scale" value="NoScale">'),i.push('<param name="DeviceFont" value="0">'),i.push('<param name="EmbedMovie" value="0">'),i.push('<param name="BGColor" value="">'),i.push('<param name="MovieData" value="">'),i.push('<param name="AllowNetworking" value="all">'),i.push('<param name="AllowFullScreen" value="true">'),i.push(a._createVideoTagForOtherBrowser(e));var o=i.join(""),r=location.pathname.split("/")[2];return a._sendLog(r,null,2),t+o+"</object>"},_sendLog:function(e,a,t){var i={thread_id:e,forum_id:PageData.forum.id||PageData.forum.forum_id,obj_locate:"pb",obj_id:0,tbs:PageData.tbs,obj_type:t||2};a&&(i.video_md5=a),$.post("/video/playStat",i)},_bindTponitVideoEvent:function(e){var a=this,t=$(".tp-video"),i=0,o=0;t.on("play",function(){var t=$(this).get(0),i=t.duration,o={action_type:"CLICK",loc_param:"PLAY",tmplId:e.tmplId,obj_param:0,params:i};0===+t.currentTime&&a._tponitVideoPostTrack(o)}),t.on("ended",function(){o+=1}),$(window).bind("beforeunload",function(){$.each(t,function(t,r){r.pause();var s=null,n=r.duration;i=o*n+(r.ended?0:r.currentTime),s={action_type:"CLICK_FEEDBACK",loc_param:"PLAY_FINISH",tmplId:e.tmplId,obj_param:i,params:n},a._tponitVideoPostTrack(s)})})},_tponitVideoPostTrack:function(e){var a="http://"+location.host+"/official/click/tpointVideoRedirect",t={line:"PT",locate:"P0248",page:"PB",task:"tpoint",client_type:"PC_WEB",loc_param:e.loc_param,action_type:e.action_type,obj_id:e.tmplId,obj_name:e.tmplId,obj_cpid:"0",obj_good_id:"0",obj_throw_type:"BY_POST",obj_param:e.obj_param,params:e.params,fid:PageData.forum.forum_id,fname:PageData.forum.forum_name,tid:PageData.thread.thread_id};$.ajax({type:"GET",url:a,data:t,dataType:"json"})}}});_.Module.define({path:"puser/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,0);$.tb.post("/home/post/follow",{un:t.un,tbs:t.tbs},function(t){t?0==t.no?o._clearLoading(n,e,0):1130036==t.no?o._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,t,o){var e=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});e.bind("onclose",function(){o=parseInt(o,10);var n=1===o?"btn-sub btn-small btn_concern_done":"btn_concern btn-attention btn-small",e=1===o?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";t.text(e).removeClass().addClass(n)})},_addLoading:function(n,t){var o=$("<span></span>"),e="",r=0,a=[".","..","..."],s=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],i=setInterval(function(){e=a[r++%3],o.text(e)},400);return n.text(s[t]).append(o),i},_clearLoading:function(n,t,o){o=parseInt(o,10);var e=1===o?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",r=1===o?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(r).removeClass().addClass(e),clearInterval(t)},_unfollow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:t.un,tbs:t.tbs},function(t){t&&0==t.no?o._clearLoading(n,e,1):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({path:"puser/widget/MonthIcon",sub:{iconTitle:{201401:"\u6469\u7FAF\u5EA7",201402:"\u6C34\u74F6\u5EA7",201403:"\u53CC\u9C7C\u5EA7",201404:"\u767D\u7F8A\u5EA7",201405:"\u91D1\u725B\u5EA7",201406:"\u53CC\u5B50\u5EA7",201407:"\u5DE8\u87F9\u5EA7",201408:"\u72EE\u5B50\u5EA7",201409:"\u5904\u5973\u5EA7",201410:"\u5929\u79E4\u5EA7",201411:"\u5929\u874E\u5EA7",201412:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(n,t){t=t||1;for(var i='<div class="month_icon_theme_'+t+'">',o="",e=201401;201412>=e;e++)o=n&&n[e]?" month_icon_"+e:" month_icon_gray_"+e,i+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[e]+'" class="'+o+'"></a>';return i+="</div>"}}});_.Module.define({path:"puser/widget/UserVisitCard",requires:["pcommon/widget/Card","UserVisitCardBase","puser/widget/Interaction","puser/widget/Residual","pcommon/widget/JoinVipDialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(i,a){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=i,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("puser/widget/Interaction"),this._residual=this.use("puser/widget/Residual"),a||this.bindEvents())},bindEvents:function(){var i=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return i.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card&&i._visit_card.closeCard({type:"delayClose",time:200}),i._visit_card=null,!1}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(i){var a=this;a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var t='<div class="user_card_loading"><img src="http://tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:a._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='user_visit_card'",wrap:$("body")};a._visit_card=a.use("pcommon/widget/Card",e),a._visit_card.showCard({type:"delayShow",time:200}),a.buildVisitCard(i)},getVisitCardContent:function(i){var a=this,t={ie:"utf-8"};i.un?t.un=i.un:t.id=i.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=i.bg_id;var r=a._util.getVisitCardTpl(1,e,!0);i.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i.wrap.html(r)}i.callBack&&$.isFunction(i.callBack)&&i.callBack()})},buildVisitCard:function(i){var a=this,t={ie:"utf-8"};i.getData().un?t.un=i.getData().un:t.id=i.getData().id,a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==a.dataObj.uname,s=a._util.getVisitCardTpl(r,e,!0);a._visit_card.setContent(s),a._visit_card._j_card.bindData({un:e.name}),a._visit_card.showCard(),a._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),a._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),a._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("pcommon/widget/JoinVipDialog",[],function(i){i.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return a.buildCard(i),!1})}})},bindVisitCardEvent:function(){var i=this;i._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"puser/widget/UserVisitCard/UserVisitCardBase",requires:["puser/widget/Icons","pcommon/widget/UserHead","pcommon/widget/MemberApi","puser/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,t){var r=PageData.product||"",i=this.use("puser/widget/Icons"),n=this.use("pcommon/widget/UserHead"),s=this.use("puser/widget/MonthIcon"),o=this.use("pcommon/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:0===parseInt(a.can_followed,10)?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:0===parseInt(a.can_followed,10)?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:t?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:r,icon_pre:i.getPreIconHtml(a.mParr_props,a),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon_tbvip:i.getTbvipIconHtml(a.tb_vip),icon:i.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="";e||(l=['<div class="interaction_wrap interaction_wrap_theme2">','<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">',"#{concernText}","</a>",'<a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a>',"</div>"].join(""));var d="";a.tb_vip&&a.tb_vip.type&&(d='<span class="userinfo_split"></span><span>\u7C89\u4E1D:'+a.followed_count+"</span>");var f=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',l,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon_tbvip}',"</div>",'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>",d,"</div>",'<div class="card_userinfo_tbvip clearfix">',"#{icon}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(f,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var t=e.can_begcard,r="";0==t?r='<a class="btn_begcard j_begcard" href="#"></a>':1==t?r='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==t&&(r='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var i={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:r};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,i)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},t=e.manager,r=null,i="",n="";this.countLen=0;for(var s in t){r=t[s];var o=r.forum_list.join("\u3001"),_=a[s];o=r.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,i+=this.getHonorItem(_.level,r.count,o),this.countLen+=String(r.count).length}var c=e.grade,l=[];for(var d in c)l.push(d);l.sort(function(e,a){return a-e});for(var f=0,m=l.length;m>f;f++){r=c[l[f]];var o=r.forum_list.join("\u3001");r.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[f],r.count,o),this.countLen+=String(r.count).length}return i+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,t){var r={level:e,title:t,count:a},i=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(i,r)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},t=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),r=0;r<e.length;r++)a.verify_forums+=this.getVForumItem(r,e[r].forum_name);return $.tb.format(t,a)},getVForumItem:function(e,a){var t="",r={},i=[];return a.length>5?(t=a.substring(0,5),t+="..."):t=a,r={index:e,verify_forum_name:t,origin_forum_name:encodeURIComponent(a)},i=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="http://tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(i,r)},getVipTips:function(e){var a="",t=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>t&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"pcommon/widget/AudioPlayer",requires:[],sub:{defaultOptions:{src:"http://play.baidu.com/player/static/flash/fmp.swf"},isReady:!1,isPlaying:!1,isMute:!1,volume:void 0,url:"",initial:function(t){var e=this;this.options=$.extend(this.defaultOptions,t);var i=$("<div></div>").css({width:1,height:1,overflow:"hidden"});i.appendTo("body"),i.html(this.renderSwf(this.options.src)),$swf=i.find("object");var s=$.browser.msie?$swf[0]:$swf.find("embed")[0];this.$container=i,this.$swf=$swf,this.swfObject=s;var a=setInterval(function(){100===e.swfObject.PercentLoaded()&&(clearInterval(a),setTimeout(function(){e.onSwfLoaded()},100))},100);window.pl=this},onSwfLoaded:function(){this.isReady=!0,this.bindEvents(),this.trigger("playerloaded",this)},renderSwf:function(){var t=['<object id="audio_player_core" width="#{width}" height="#{height}" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#4,0,0,0">','<param name="quality" value="high" />','<param name="allowscriptaccess" value="always">','<param name="scale" value="noscale">','<param name="wmode" value="window">','<param name="movie" value="#{srcWithStamp}">','<embed name="audio_player_core" width="#{width}" height="#{height}" allowscriptaccess="always" wmode="window" scale="noscale" src="#{srcWithStamp}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">',"</object>"].join("");return function(e){return $.tb.format(t,{src:e,srcWithStamp:e,width:1,height:1})}}(),bindEvents:function(){this.bind("reset",this._reset,this),this.bind("load",this._load,this),this.bind("play",this._play,this),this.bind("pause",this._pause,this),this.bind("stop",this._stop,this),this.bind("setmute",this._setMute,this)},_reset:function(){this.stop(),this.url="",this.isPlaying=!1},_load:function(t,e,i,s){function a(){var t=n._getLoadedPercent();return t>.3?(n.trigger("songloaded",t),n.failHandler&&clearTimeout(n.failHandler),i&&i(),!0):!1}var n=this;this.url=e,this.swfObject.closeStream(),this.swfObject.f_load(e),this.failHandler&&clearTimeout(this.failHandler),this.failHandler=setTimeout(function(){s&&s()},5e3),this.checkLoadedHandler&&clearTimeout(this.checkLoadedHandler),this.checkLoadedHandler=setTimeout(function(){a()||(n.checkLoadedHandler=setTimeout(arguments.callee,50))},50)},_play:function(t,e,i,s){function a(){var t=n._getCurrentPosition();return i&&i({percent:t,totalTime:n._getTotalTime(),currentTime:n._getCurrentTime()}),1==t?(n.trigger("playfinish",t),s&&s(),!0):!1}var n=this;if(!this.isPlaying){var o=this._getTotalTime();this.swfObject.f_play(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!0,e&&e({totalTime:o}),this.checkFinishedHandler=setTimeout(function(){a()||(n.checkFinishedHandler=setTimeout(arguments.callee,500))},1e3)}},_pause:function(){this.isPlaying&&(this.swfObject.f_pause(),this.isPlaying=!1)},_stop:function(){this.swfObject.f_stop(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!1},_setMute:function(t,e){this.isMute=e,this.swfObject.setData("mute",e)},_setVolume:function(t,e){this.volume=e,this.swfObject.setData("volume",e)},_setCurrentPosition:function(){},_getCurrentPosition:function(){return this.swfObject.getData("postionPct")},_getLoadedPercent:function(){return this.swfObject.getData("loadedPct")},_getTotalTime:function(){return this.swfObject.getData("length")},_getCurrentTime:function(){return this.swfObject.getData("currentPosition")}}});_.Module.define({path:"pcommon/widget/Voice",requires:["pcommon/widget/Card","pcommon/widget/AudioPlayer"],sub:{version:"0.1",dialog:null,api:"/voice/index?",pidWhiteList:[40649447103,40649504943,40649558518,40649601183],initial:function(t){if(!PageData.pbVoiceLoaded){PageData.pbVoiceLoaded=!0;var i=this;this.product=PageData.product,this.product&&(this.api=t&&t.api||this.api,this.useMd5=t&&t.useMd5,this.canPlay=t&&t.canPlay,this.showClientAd=t&&t.showClientAd,this.showPostorAd=t&&t.showPostorAd,"frs"===this.product&&(this.showClientAd=1==this.canPlay?0:t.frsShowClientAd),$("body").on("click",".voice_player a ",function(t){t.preventDefault()}),1==this.showPostorAd&&this.initPostorAd(),this.initPlayer(),$(window).bind("initvoicelength",function(t,i){var e=$(i),a=e.find(".minute"),n=e.find(".second");if(a.length>0||n.length>0&&n.text()>=30)e.width(125);else if(n.length>0){var o=n.text();5>=o?e.width(50):e.width(50+3*(o-5))}}),$(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}),$("body").bind("showvoicedialog",function(t,e){i.dialog?i.dialog.show():(dialog=new $.dialog({width:398,html:$(".voice_client_ad_template").html(),title:"",draggable:!1,show:!1}),dialog.element.addClass("voice_dialog"),e&&dialog.element.addClass("voice_dialog_post"),dialog.show(),dialog.modal.bind("click",function(){dialog.hide()}))}))}},initClientAd:function(){$("body").on("click",".voice_player a",function(){$("body").trigger("showvoicedialog")})},initPostorAd:function(){$("#j_p_postlist").on("click",".j_lzl_p_sv",function(t){t.stopPropagation();var i=$(this);i.find(".new_icon").remove(),$.tb.Storage.set("VoicePostorAdClosed",1),$.stats.track("lzl_poster","pc_voice"),$("body").trigger("showvoicedialog",!0)})},initPlayer:function(){var t=this;this.player=this.use("pcommon/widget/AudioPlayer"),this.player.bind("playerloaded",function(){t.bindPlayerEvent(),t.player._setVolume("",100)})},bindPlayerEvent:function(){var t=this,i=this.animateIcon,e=this.player,a=null;$("body").on("click",".voice_player a",function(n){function o(t){t.totalTime>0&&!g.data("time")&&0!=t.totalTime&&g.data("time",t.totalTime)}function s(i){var e=(0!=i.totalTime?i.totalTime:g.data("time"))-i.currentTime;t.updateTime(g,e)}function r(){c.data("state",""),t.resetTime(g),i.reset(p)}n.preventDefault(),$.stats.track("voice_btn_total","pc_voice");{var l,d,c=$(this).parent(".voice_player"),p=c.find(".speaker"),g=c.find(".time"),h=c.hasClass("voice_player_mini");h?"lzl":t.product}if(c.hasClass("in_live_thread")){var m=c.data("info")||{};l=m.tid,d=m.pid}else"pb"===t.product?(l=PageData.thread&&PageData.thread.thread_id,d=h?c.parents(".j_lzl_s_p").getData().spid:c.parents(".l_post").getData().content.post_id):"frs"==t.product?l=c.parents(".j_thread_list").data("field").id:"index"==t.product&&(l=c.data("tid"));var u="";if(u=1==t.useMd5?t.api+"?voice_md5="+c.data("md5")+"&kw="+PageData.forum.forum_name+"&tbs="+PageData.tbs:t.api+"tid="+l+(d?"&pid="+d:""),1!=t.canPlay&&-1==$.inArray(d,t.pidWhiteList))return a&&(e.trigger("stop"),t.resetPrevPlayer(a)),$.stats.track("voice_dialog_show","pc_voice"),$("body").trigger("showvoicedialog"),void 0;if("playing"===c.data("state"))e.trigger("stop"),c.data("state",""),i.reset(p),t.resetTime(g),$.stats.track("voice_stop","pc_voice");else{t.resetPrevPlayer(a),e.trigger("stop"),c.data("state","playing"),i.set(p,"loading"),$.stats.track("voice_play","pc_voice");var v=g.find(".minute"),f=g.find(".second"),_=v.length>0?+v.html():0,y=f.length>0?+f.html():0;g.data("time",6e4*_+1e3*y),e.trigger("load",u,function(){e.trigger("play",o,s,r),i.set(p,"playing")},function(){e.trigger("stop"),c.data("state",""),i.reset(p),t.resetTime(g);var a=$.tb.alert({title:"\u64AD\u653E\u5931\u8D25",message:"\u6211\u4E0D\u662F\u6545\u610F\u7684\uFF0C\u64AD\u653E\u5931\u8D25\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u4E0B\u5427~",buttons:[{text:"\u786E\u8BA4"}],width:310});a.modal.bind("click",function(){a.hide()})}),a=c}})},updateTime:function(t,i){i=i||t.data("time")||0;var e=Math.floor(i/6e4),a=Math.round(i%6e4/1e3),n="";e>0&&(n+='<span class="minute">'+e+"</span>'"),(a>0||e>0)&&(n+='<span class="second">'+a+'</span>"'),t.html(n)},resetTime:function(t){this.updateTime(t)},resetPrevPlayer:function(t){if(t){var i=t.find(".speaker"),e=t.find(".time");t.data("state",""),this.resetTime(e),this.animateIcon.reset(i)}},animateIcon:function(){function t(t,i){if($.browser.mozilla){var e=t.parent().parent().hasClass("loading")?"loading":"playing",a=t.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal",n=i+"px "+s[a][e]+"px";t.css("background-position",n)}else t.css("background-position-x",i)}function i(i,s){l&&e(l),e(i),l=i,i.parent().parent().addClass(s);var d=i.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal";"playing"===s?(i.parent().parent().hasClass("voice_player_mini")?t(i,-38):t(i,-58),r=setTimeout(function(){var e=0;return function(){e=(e+1)%4,t(i,a[d][e]),r=setTimeout(arguments.callee,o[s])}}(),o[s])):"loading"===s&&(i.parent().parent().hasClass("voice_player_mini")?t(i,-1):t(i,-1),r=setTimeout(function(){var e=0;return function(){e=(e+1)%12,t(i,-1-e*n[d]),r=setTimeout(arguments.callee,o[s])}}(),o[s]))}function e(i){clearTimeout(r),i.parent().parent().removeClass("loading playing"),i.parent().parent().parent().hasClass("voice_player_mini")?t(i,-38):t(i,-58)}var a={normal:[-1,-20,-39,-58],mini:[1,-12,-25,-38]},n={normal:20,mini:15},o={playing:400,loading:100},s={normal:{playing:-202,loading:-167},mini:{playing:-264,loading:-237}},r=null,l=null;return{set:i,reset:e}}()}});_.Module.define({path:"common/component/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="ui_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"encourage/widget/meizhi_vote",requires:["common/component/Card"],sub:{_visit_card:null,_vote_card:null,_visit_card_ajax:null,_vote_button:null,_visit_card_option:{width:280,height:237},_special_visit_card_option:{width:280,height:210},initial:function(){this._wrap=$("body"),this._is_meizhi=PageData.user.is_login&&PageData.user.meizhi_level>=0?!0:!1,this.bindEvents()},bindEvents:function(){var t=this;this._wrap.delegate(".j_meizhi_vip","mouseenter",function(){return t.buildVisitCard(this),!1}),this._wrap.delegate(".j_meizhi_vip","mouseleave",function(){return t._visit_card_ajax&&t._visit_card_ajax.abort(),t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:200}),t._visit_card=null,!1}),this._wrap.delegate(".j_meizhi_vote","click",function(e){return t._vote_card&&(t._vote_card.closeCard(),t._vote_card=null,t._vote_button==e.target)?(e.preventDefault(),!1):(t.buildVoteCard(this),t._vote_button=e.target,e.preventDefault(),void 0)})},buildVoteCard:function(t){var e=this,i=$(t).getData(),a=i.user_id;$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),s=$(t),_=s.offset().left-140+s.outerWidth(!0)/2,d=s.offset().top-64-12;e._vote_card&&(e._vote_card.closeCard(),e._vote_card=null),e._vote_card=e.use("common/component/Card",{content:n,card_css:{top:d,left:_,width:280,height:64},attr:"id='meizhi_vote_card'",wrap:$("body")}),e.bindVoteCardEvent()}})},bindVoteCardEvent:function(){var t=this;t._vote_card.showCard(),t._vote_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("frs_btn","meizhi_vote"),t.vote(this)})},vote:function(t){var e=this,i=$(t),a=i.getData(),o=a.vote_type,n="/encourage/post/meizhi/checkvcode",s="/encourage/post/meizhi/getvcode";_.Module.use("common/component/PostorServiceMeizhi",[],function(t){t.postHandler({data:{content:"",tbs:PageData.tbs,fid:PageData.forum.id||PageData.forum.forum_id,kw:PageData.forum.name,uid:a.user_id,scid:PageData.user.id||0,vtype:o,ie:"utf-8",vcode:""},checkUrl:n,vCodeUrl:s,url:"/encourage/post/meizhi/vote",type:"vote",success:function(t){var a=t,n=$('<img class="add_one_icon" src="/tb/static-encourage/img/meizhi/add_one.gif">');n.appendTo(i).animate({top:"-=20",opacity:0},1e3);var s=e.cutVoteCount(a.vote_count[o]);s=s?s:1,i.find(".j_vote_count").text(s);var _=i.parent();_.find(".j_vote_text").addClass("vote_text_small"),_.find(".j_vote_count").removeClass("hide"),_.siblings(".j_vote_tip").text("\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002"),_.addClass("disabled").find(".j_vote_button").removeClass("j_vote_button"),1==a.hasCheckVcode&&e._msgDialog(),$.stats.track("vote_succ","meizhi_vote")}})})},_msgDialog:function(){var t={image:'<img style="border:none;" src="http://tb1.bdstatic.com/tb/img/messageFace.gif">',subMessage:"\u6295\u7968\u6210\u529F",message:"",dialogSet:{width:410,height:50,title:"\u53D1\u8D77\u6295\u7968"}},e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>";$.dialog.alert(e,t.dialogSet)},buildVisitCard:function(t){var e=this,i=$(t).parent().getData(),a=i.user_id;this._visit_card_ajax&&this._visit_card_ajax.abort(),this._visit_card_ajax=$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a,type:1},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=o.level-1?o.level-1:"",s=e.calPercent(o.vote_count),_="/i/sys/jump?un="+encodeURIComponent(o.uname)+"&ie=utf-8",d=o.group_info.has_group,v=d?'<span class="group_icon" title="\u5FEB\u5230\u88D9\u91CC\u6765">&nbsp;</span>':"",r=d?'<div class="clearfix"><span style="display:inline;float:left;">Ta\u7684\u7FA4\u7EC4\uFF1A</span><a class="group_name" href="/group/index?id='+o.group_info.group_id+'" target = "_blank" >'+o.group_info.group_name+"</a></div>":"",c=["<a href="+_+' title="\u5934\u50CF" class="meizhi_avatar" target="_blank"><img src="'+o.avatar+'"></a>','<div class="meizhi_corner"></div>','<div class="meizhi_info">','<h1 class="clearfix"><a class="name" href='+_+' title="\u540D\u5B57" target="_blank">'+o.uname+"</a>"+v+"</h1>",r,'<div>\u7B49\u7EA7\uFF1A<span class="level">MVP'+n+"</span></div>",'<div>\u6240\u5728\u5427\uFF1A<span class="forum_name">'+o.forum_name+"\u5427</span></div>","</div>",'<p><a href = "/p/'+o.thread_id+'" target = "_blank" >\u770B\u770BTa\u7684\u8BA4\u8BC1\u8D34>>></a></p>',"<p>\u5DF2\u6295\u7968\u6BD4\u4F8B\uFF1A</p>",'<div class="meizhi_vote_weight_wrap">','<span class="vote_weight_meizhi" style="width:'+s.meizhi_orign_percent+'%">'+s.meizhi_need_percent+"</span>",'<span class="vote_weight_weiniang" style="width:'+s.weiniang_orign_percent+'%;">'+s.weiniang_need_percent+"</span>",'<span class="vote_weight_renyao" style="width:'+s.renyao_orign_percent+'%;">'+s.renyao_need_percent+"</span>","</div>"].join(""),l=e._is_meizhi;l||(c+=o.can_vote?'<p class="j_vote_tip">\u6295\u51FA\u65E0\u8282\u64CD\u7684\u771F\u8BDA\u4E00\u7968\uFF01</p>':"<p>\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002</p>"),c+=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),c+=e.addTip(o,l);var u=$(t),p=l?e._special_visit_card_option:e._visit_card_option;e._visit_card&&(e._visit_card.closeCard(),e._visit_card=null),e._visit_card=e.use("common/component/Card",{content:c,card_css:{width:p.width,height:p.height},auto_positon:!0,event_target:u,attr:"id='meizhi_visit_card'",wrap:$("body")}),e.bindVisitCardEvent()}})},addTip:function(t,e){var i;return i=e?'<p class="level_up_tip"><span class="level_up_tip_title">\u5B8C\u6210\u5EA6:</span>\u83B7\u5F97'+t.exp_value+"\u70B9\u7ECF\u9A8C\u3001"+t.levelup_left+"\u5F20\u59B9\u7EB8\u7968\u540E\u5347\u7EA7</p>":'<a class="meizhi_card_tip" href="http://tieba.baidu.com/tb/zt/meizhi/index.html" target="_blank">\u4EC0\u4E48\u662F\u59B9\u7EB8\u8BA4\u8BC1\u7CFB\u7EDF>></a>'},calPercent:function(t){var e=t.meizhi+t.weiniang+t.renyao,i=Math.round(t.meizhi/e*100),a=Math.round(t.weiniang/e*100),o=100-i-a,n=10,s=i>n?i+"%":"",_=a>n?a+"%":"",d=o>n?o+"%":"";$.browser.msie&&$.browser.version<8&&(i>30?i-=1:a>30?a-=1:o>30&&(o-=1));var v={meizhi_orign_percent:i,weiniang_orign_percent:a,renyao_orign_percent:o,meizhi_need_percent:s,weiniang_need_percent:_,renyao_need_percent:d};return v},buildVoteBtnGroup:function(t,e,i){var a;if(this._is_meizhi)a=['<div class="meizhi_vote_button_wrap meizhi_disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");else if(t){var o={user_id:e,vote_type:"meizhi"},n={user_id:e,vote_type:"weiniang"},s={user_id:e,vote_type:"renyao"};a=['<div class="meizhi_vote_button_wrap">','<div class="j_vote_button vote_button vote_button_meizhi"'+$.tb.dataField(o)+">",'<div class="vote_text j_vote_text">\u59B9\u7EB8</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_weiniang"'+$.tb.dataField(n)+">",'<div class="vote_text j_vote_text">\u4F2A\u5A18</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_renyao"'+$.tb.dataField(s)+">",'<div class="vote_text j_vote_text">\u4EBA\u5996</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("")}else a=['<div class="meizhi_vote_button_wrap disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");return a},cutVoteCount:function(t){return t>9999?"9999+":t},bindVisitCardEvent:function(){var t=this;this._visit_card.showCard({type:"delayShow",time:200}),this._visit_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("card_btn","meizhi_vote"),t.vote(this)})}}});
;var Thread_add_result={resultNo:0,fid:"",tid:"",vid:"",sign:"",bdauditreason:0,bdQueryWordEnc:"",autoMsg:"",is_login:0,init:function(e){if(Thread_add_result&&e.data&&"object"==typeof e.data)for(var a in e.data)Thread_add_result[a]=e.data[a];Thread_add_result.resultNo=e.no},isNeedWaitForCheck:function(){var e=!1;switch(this.resultNo){case 9:case 20:case 23:e=!0}return e},isNeedBindPhone:function(){return 4010==this.resultNo},Action_FocusTitle:"focusTitle",Action_FocusContent:"focusContent",Action_ClearYZM:"clearYZM",Action_FocusUrl:"focusUrl",Action_GoToHead:"goToHead",Action_FlushAndGoToHead:"flushAndGoToHead",getActionType:function(){var e="";switch(this.resultNo){case 10:case 14:case 501:case 15:case 36:case 41:case 42:case 43:case 46:case 9001:case 10010:case 10011:case 10012:case 10013:case 220012:case 220015:case 220035:case 2130001:case 2130007:case 2130008:case 2130009:case 2130011:case 2130012:case 2130014:case 2130005:e=this.Action_FocusContent;break;case 11:case 20:e=this.Action_FocusTitle;break;case 17:case 0:e=this.Action_FlushAndGoToHead;break;case 22:case 9:case 23:case 119:case 44:case 100:case 703:case 704:case 705:e=this.Action_GoToHead;break;case 38:case 39:case 40:e=this.Action_ClearYZM;break;case 1120:case 1121:e=this.Action_FocusUrl}return e},getMessage:function(){var e="",a=null;if(this.resultNo>=901&&this.resultNo<=950)return Thread_add_result.autoMsg;switch(null==a&&(a=PageData.forum?PageData.forum.id:null),null==a&&(a=PageData.forum_id),null==a&&(a=PageData.forumID),this.resultNo){case 10:e="\u8D34\u5B50\u5185\u5BB9\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57";break;case 11:e="\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F";break;case 12:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u8D26\u53F7\u56E0\u8FDD\u89C4\u64CD\u4F5C\u800C\u88AB\u5C01\u7981&nbsp;&nbsp;<a href='/pmc/main' target=\"_blank\">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>":"\u64CD\u4F5C\u5931\u8D25";break;case 13:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid="+a+'\' target="_blank">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>':"\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01 ";break;case 14:e="\u60A8\u53D1\u5E03\u7684\u8D34\u5B50\u5DF2\u7ECF\u5B58\u5728";break;case 501:case 15:e="\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34";break;case 16:e="\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6240\u8F93\u5165\u7684\u8D34\u5427\u4E0D\u5B58\u5728\u3002\u7531\u4E8E\u7CFB\u7EDF\u5347\u7EA7\u7EF4\u62A4\uFF0C\u65B0\u5EFA\u8D34\u5427\u529F\u80FD\u6682\u505C\uFF0C\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\uFF01";break;case 19:case 200:case 201:case 202:e="\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868";break;case 20:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868";break;case 17:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 18:case 21:e="\u5176\u4ED6\u672A\u77E5\u539F\u56E0";break;case 22:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u7531\u4E8E\u7279\u6B8A\u539F\u56E0\u6211\u4EEC\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u6211\u4EEC\u4F1A\u572810\u5206\u949F\u5185\u786E\u8BA4\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\uFF01";break;case 9:e=this.getCheckMessage(this.bdauditreason);break;case 33:e=1==Thread_add_result.is_login?"\u60A8\u53D1\u8D34\u592A\u5FEB\u4E86:) \u8BF7\u7A0D\u540E\u518D\u53D1":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 34:e=1==Thread_add_result.is_login?"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 220034:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898";break;case 220035:e="\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~";break;case 35:e=1==Thread_add_result.is_login?"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 36:e="\u8BF7\u4E0D\u8981\u53D1\u5E7F\u544A\u8D34\uFF01";break;case 37:e="\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 38:e="\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";break;case 39:e="\u7531\u4E8E\u60A8\u591A\u6B21\u8F93\u9519\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 40:e="\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165";break;case 41:e="\u60A8\u7684\u8D34\u5B50\u53EF\u80FD\u5305\u542B\u4E0D\u5408\u9002\u7684\u5185\u5BB9\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u63D0\u4EA4";break;case 42:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u88AB\u7CFB\u7EDF\u8BA4\u4E3A\u6709\u53D1\u5E7F\u544A\u5ACC\u7591\uFF0C\u8BF7\u60A8\u7A0D\u540E\u518D\u53D1";break;case 43:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u6216\u8D34\u5B50\u5185\u5BB9\u6709\u5E7F\u544A\u6216\u4E0D\u5408\u9002\u7684\u7279\u5F81\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u53D1\u9001";break;case 23:e="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u9700\u8981\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u5EFA\u7ACB\u8D34\u5427";break;case 119:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898";break;case 1120:e="\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='http://www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539";break;case 1121:e="\u62B1\u6B49\uFF0C\u89C6\u9891\u670D\u52A1\u5347\u7EA7\u4E2D\uFF0C\u60A8\u6682\u65F6\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u89C6\u9891\u7684\u8D34\u5B50\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u8BF7\u539F\u8C05";break;case 44:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8868\u4E3B\u9898\u8D34\u5B50\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u6216\u56DE\u590D\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 100:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u4F7F\u7528\u5B8C\u6574\u7684\u8D34\u5427\u529F\u80FD\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 701:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u4E0D\u5141\u8BB8\u672A\u767B\u5F55\u7528\u6237\u53D1\u8D34\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 702:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 703:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u4F1A\u5458\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F\u3002<a href='/f?kw="+this.bdQueryWordEnc+"#1' target=_blank>\u70B9\u6B64\u7533\u8BF7\u52A0\u5165</a>\u672C\u5427\u4F1A\u5458";break;case 704:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u7BA1\u7406\u56E2\u961F\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 705:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 706:e="\u62B1\u6B49\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 45:e="\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0";break;case 46:e="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!";break;case 800:break;case 801:break;case 802:break;case 803:break;case 804:break;case 805:break;case 806:break;case 807:break;case 808:break;case 809:break;case 814:break;case 815:e="\u62B1\u6B49\uFF0C\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u6216\u672A\u8D2D\u4E70\u97F3\u4E50\u9053\u5177\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5";break;case 900:e="\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 961:e="\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09";break;case 9001:e="\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002";break;case 2100:e="\u5185\u5BB9\u542B\u6709\u9AD8\u7EA7\u5B57\u4F53\u6548\u679C\uFF0C\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5C31\u80FD\u4F7F\u7528\u54E6~~";break;case 4010:e="\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002";break;case 9e3:e="\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002";break;case 10010:e="\u60A8\u7684\u6027\u522B\u65E0\u6CD5\u8FDB\u884C\u59B9\u7EB8\u8BA4\u8BC1</br><a style = 'font-size:12px;' href = 'http://www.baidu.com/p/setting/profile/basic' target ='_blank'>\u53BB\u4FEE\u6539\u6211\u7684\u6027\u522B>><a>";break;case 10012:e="\u8BF7\u4E0A\u4F20\u81F3\u5C11\u4E00\u5F20\u56FE\u7247\u3002";break;case 10013:e="\u60A8\u53D1\u5F80\u7684\u5427\u672A\u5F00\u901A\u59B9\u7EB8\u8BA4\u8BC1\u529F\u80FD\u3002";break;case 2130001:e="\u8BF7\u4E0D\u8981\u7ED9\u975E\u59B9\u7EB8\u7528\u6237\u6295\u7968\u3002";break;case 2130007:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2130008:e="\u60A8\u5DF2\u7ECF\u7ED9\u8BE5\u7528\u6237\u6295\u8FC7\u7968\u3002";break;case 2130009:e="\u6295\u7968\u5931\u8D25\u3002";break;case 2130005:e="\u60A8\u5DF2\u7ECF\u53D1\u8D77\u8FC7\u59B9\u7EB8\u8BA4\u8BC1\u8D34</br><a href='/p/"+Thread_add_result.thread_id+"' target = '_blank' >http://tieba.baidu.com/p/"+Thread_add_result.thread_id+"</a>";break;case 2130011:e="\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E4B\u95F4\u4E0D\u80FD\u76F8\u4E92\u6295\u7968\u3002";break;case 220012:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 220013:e="\u60A8\u7684IP\u5DF2\u88AB\u5C01\u7981\u3002";break;case 225001:e="\u60A8\u7684\u8D26\u53F7\u7981\u6B62\u8D34\u6761\u3002";break;case 220015:e="\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u542B\u6709\u654F\u611F\u4FE1\u606F\u3002";break;case 219e4:e="<p>\u62B1\u6B49\u60A8\u6CA1\u6709\u8D34\u6761\u9053\u5177\u4E86\u4E0D\u80FD\u53D1\u5E03\u8D34\u6761\u4FE1\u606F\u3002</p><p>PS\uFF1A\u53D1\u8D34,\u56DE\u8D34,\u53C2\u52A0\u6D3B\u52A8\u90FD\u6709\u673A\u4F1A\u83B7\u5F97\u8D34\u6761\u9053\u5177\u3002</p>";break;case 2130012:e="\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u6295\u7968\u3002";break;case 2130014:e="\u4E0D\u80FD\u7ED9\u7537\u6027\u7528\u6237\u6295\u7968";break;case 2190001:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u5566\uFF0C\u8BF7\u4F11\u606F\u4E00\u4E0B\u3002";break;case 2190002:e="\u62B1\u6B49\uFF0C\u6BCF10\u5206\u949F\u53EA\u80FD\u62A2\u4E00\u6B21\u8D34\u6761\u3002";break;case 2190003:e="<p>\u771F\u9057\u61BE~\u60A8\u6CA1\u6709\u62A2\u5230\u8D34\u6761\u9053\u5177\u3002</p><p>PS\uFF1A\u7B49\u7EA7\u8D8A\u9AD8\u83B7\u5F97\u9053\u5177\u51E0\u7387\u8D8A\u9AD8\u54E6\uFF01</p>";break;case 2190004:e="\u670D\u52A1\u5668\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5";break;case 2190005:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2190006:e="\u8D34\u6761\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u3002";break;case 2190007:e="\u8D34\u6761\u5185\u5BB9\u8FC7\u957F\u3002";break;case 2190008:e="\u4ECA\u5929\u7684\u9053\u5177\u88AB\u62A2\u5B8C\u5566\uFF0C\u660E\u5929\u7EE7\u7EED\u52A0\u6CB9\uFF01";break;default:e="\u672A\u77E5\u9519\u8BEF\u3002"}return e},getCheckMessage:function(e){var a="";switch(e){case-61:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u6240\u53D1\u7684\u8D34\u5B50\u5F85\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-62:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u8D34\u56FE\u7684\u8D34\u5B50\u9700\u8981\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-74:case-75:case-60:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-70:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u63A7\u5236\u5E7F\u544A\u8D34\uFF0C\u9700\u8981\u901A\u8FC7\u5BA1\u6838\u540E\u624D\u80FD\u53D1\u5E03\u3002\u767B\u9646\u7F72\u540D\u53D1\u8D34\u4E0D\u53D7\u6B64\u9650\u5236\u3002";break;case-71:a="\u60A8\u53D1\u8868\u7684\u5E16\u5B50\u592A\u957F\u4E86\u3002\u4E3A\u4E86\u9632\u6B62\u704C\u6C34\uFF0C\u9700\u7CFB\u7EDF\u5BA1\u6838\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u7A0D\u540E\u67E5\u770B";break;default:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85"}return a}};_.Module.define({path:"encourage/widget/WelfareIcon",sub:{_card:null,_isGifing:!1,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;this._wrap.on("mouseenter",".j_score_welfare",function(){t._buildCard(this)}).on("mouseleave",".j_score_welfare",function(){return t._card&&t._card.closeCard({type:"delayClose",time:200}),t._card=null,!1}).on("click",".j_score_welfare",function(e){return t.showGif(e),!1})},showGif:function(t){var e=$("<div></div>"),i=this,o="http://tb1.bdstatic.com/tb/r/image/2014-04-11/968642070f6c20e5274ba44b5a75707f.gif",n=$('<img style="position:absolute;z-index: 50000; left: 80px; top: 80px;width:1px;height: 1px;" src="">');this._isGifing||(this._isGifing=!0,e.css({position:"absolute",zIndex:5e4,left:t.pageX-80,top:t.pageY-80}),e.append(n),$("body").append(e),setTimeout(function(){n.tbattr("src",o)},0),n.animate({width:190,height:134,top:0,left:0},300),setTimeout(function(){n.animate({width:1,height:1,top:80,left:80},300,function(){e.remove(),i._isGifing=!1})},3e3))},_buildCard:function(t){var e,i=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u6709\u6548\u671F\uFF1A2014\u5E7412\u670831\u65E5</p></div>"].join(""),o=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u53D1\u798F\u5229\u6709\u673A\u4F1A\u83B7\u5F97\uFF01</p>",'<p style="color:#fc6853">\u70B9\u6211\uFF01</p></div>'].join(""),n=$(t),s=n.getData();if(s){e=s.user_id!==PageData.user.user_id?o:i;var a=n.offset().left-86+n.outerWidth(!0)/2,d=n.offset().top-64-12;this._card=this.use("common/widget/Card",{content:e,card_css:{top:d,left:a,width:172},auto_positon:!0,event_target:n,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}}});_.Module.define({path:"encourage/widget/achieveCard",requires:["common/component/Card"],sub:{initial:function(){this._wrap=$("body"),this._bindEvent()},_bindEvent:function(){var a=this;this._wrap.on("mouseenter",".j_fighter",function(e){var t=$(e.target),i=t.getData();$.post("/tbmall/gthread/iconbanner",{tbs:PageData.tbs,user_id:i.user_id},function(e){var i=t.offset();if(0===e.no){var c='<div class="achievement_card">    <p class="achievement_card_content">       <img class="achievement_card_img" src="http://tb.himg.baidu.com/sys/portrait/item/'+e.data.portrait+'" alt="" height=66 width=66 />        <span class="achievement_card_uname">'+e.data.user_name+'</span><i class="achievement_card_icon"></i></br>        <span class="achievement_card_medal">\u9996\u5C4A\u62F3\u738B\u4E89\u9738\u8D5B - '+e.data.icon_name+' </span></br>    </p><a class="achievement_card_link" href="/tbmall/gthread/center" target="_blank">\u9996\u5C4A\u8D34\u5427\u62F3\u738B\u4E89\u9738\u8D5B>></a></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:265,"z-index":1e3,top:i.top-117-12,left:i.left-126,card_leave_display:!0},wrap:$("body"),attr:"id='achieve_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}})}).on("mouseleave",".j_fighter",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_fighter",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_cup_a, .j_cup_b",function(e){var t=$(e.target),i=t.offset(),c="A CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_a.png";$(this).hasClass("j_cup_b")&&(c="B CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_b.png");var n='<div class="cup_card"><div class="cup_card_top clearfix"><img src="'+d+'" width="57" height="57" /><p class="title">'+c+'</p><p>\u8981\u4E24\u4E2A\u4E00\u8D77\u624D\u591F\u597D\uFF01</p></div><div class="cup_card_bottom"><a href="/f?ie=utf-8&kw=%E4%B8%96%E7%95%8C%E6%9D%AF#cupicon" target="_blank">\u4E16\u754C\u676F\u671F\u95F4\u7ED9\u5973\u795E\u9C9C\u82B1\u83B7\u5F97\uFF01</a></div></div>';a._medalCard=a.use("common/component/Card",{content:n,card_css:{width:235,"z-index":1e3,top:i.top-110-12,left:i.left-110,card_leave_display:!0},wrap:$("body"),attr:"id='cup_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_cup_a, .j_cup_b",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_cup_a, .j_cup_b",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_minigame",function(e){var t=$(e.target),i=(t.getData(),t.offset()),c='<div class="minigame_card"><div class="minigame_card_top clearfix"><img src="http://tb1.bdstatic.com/tb/r/image/2014-08-05/32d9b951b986efbb2ad5ce0f445ce9be.png" width="57" height="57" /><p class="title">\u6E38\u620F\u738B\u5370\u8BB0</p><p>\u5728\u3010T\u8C46\u5C0F\u6E38\u620F\u3011\u4E2D\u8FDE\u7EED3\u5929\uFF0C\u6BCF\u5929\u81F3\u5C11\u5B8C\u6210\u4E00\u5C40\u6BD4\u8D5B\uFF0C\u5373\u53EF\u83B7\u5F97\u3002</p></div><div class="minigame_card_bottom"><a href="/minigame/home" target="_blank">T\u8C46\u5C0F\u6E38\u620F</a></div></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:275,"z-index":1e3,top:i.top-110-12,left:i.left-130,card_leave_display:!0},wrap:$("body"),attr:"id='minigame_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_minigame",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})})}}});_.Module.define({path:"fanclub/widget/fancard",requires:["common/widget/Card"],sub:{_fancard:null,_fancard_ajax:null,_fancard_data:{},_forum_id:"0",initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var a=this;this._wrap.delegate(".j_fanclub_vip","mouseenter",function(){return $(this).tbattr("title",""),a._getCardData(this),!1}),this._wrap.delegate(".j_fanclub_vip","mouseleave",function(){return a._fancard_ajax&&a._fancard_ajax.abort(),a._fancard&&a._fancard.closeCard({type:"delayClose",time:200}),a._fancard=null,!1})},_getCardData:function(a){var t=$(a).getData();if(t){var n=t.user_id,r=this;this._fancard_ajax=$.ajax({type:"GET",url:"/frsstar/browse/fanclub/fanInfo?userid="+n,dataType:"json",success:function(t){switch(t.no){case 0:r._fancard_data=t,r._buildCard(a)}},error:function(){$(a).tbattr("title","\u7F51\u7EDC\u9519\u8BEF")}})}},_buildCard:function(a){var t="",n=this._fancard_data.fanclub_array.length;n>3&&(n=3);for(var r=0;n>r;r++)0==r&&(this._forum_id=this._fancard_data.fanclub_array[r].forum_id),t+='<a  target="_blank"  href="/f?kw='+encodeURIComponent(this._fancard_data.fanclub_array[r].name)+'&ie=utf-8" class="fanclub_card_forum_name">'+this._fancard_data.fanclub_array[r].name+' <span class="fanclub_icon fanclub_icon_vip_'+this._fancard_data.fanclub_array[r].level+'"></span></a>',n-1>r&&(t+='<a class="fanclub_card_forum_name_gap">|</a>');var e=['<div id="fanclub_card_container">','<div class="fanclub_card_head">','<a  target="_blank"  href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8"  ><img src="http://tb.himg.baidu.com/sys/portrait/item/'+this._fancard_data.portrait+'" alt="" /></a>',"</div>",'<div class="fanclub_card_right">','<a target="_blank" href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8" class="fanclub_card_right_title">'+this._fancard_data.username+'<span class="fanclub_icon fanclub_icon_frs "></span></a>',"<p>\u52A0\u5165\u4F1A\u5458\u65F6\u95F4:<span>"+this._formatDate(this._fancard_data.entertime)+"</span></p>","<p>\u5DF2\u52A0\u5165\u7C89\u4E1D\u4F1A:<span>"+this._fancard_data.fanclub_count+"\u4E2A</span></p>","</div>",'<div class="fanclub_card_forum_icon_wrapper" >',t,"</div>",'<div class="fanclub_card_bottom">','<a  target="_blank"  href="http://tieba.baidu.com/p/2676282434">\u4EC0\u4E48\u662F\u7C89\u4E1D\u4F1A\u5458&gt;&gt;</a>',"</div>","</div>"].join(""),_=$(a),i=_.offset().left-140+_.outerWidth(!0)/2,d=_.offset().top-64-12;this._fancard=this.use("common/widget/Card",{content:e,card_css:{top:d,left:i,width:302,height:147},auto_positon:!0,event_target:_,attr:"id='fancard_show'",wrap:$("body")}),this._fancard.showCard({type:"delayShow",time:200})},_buildErrorCard:function(){},_formatDate:function(a){var t=new Date(1e3*a);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"pplatform/widget/LocalityPopWindow",requires:[],sub:{initial:function(t,o){var i=$.parseJSON(t);i&&(this.pageMap={0:"FRS",1:"PB","0,1":"\u5168\u90E8"},this.windowTypeMap={1:"\u56FE\u7247\u5F39\u7A97","00":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E00","01":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E8C"},this.popWindow=$(".locality_pop_window_wrap"),this.bindEvents(i,o),this.runStrategy(i))},bindEvents:function(t,o){var i=this,a=i.pageMap[t.position],e="1"==t.type?t.type:t.type.toString()+t.subtype.toString();e=i.windowTypeMap[e],$(".locality_pop_window_wrap").on("click",".locality_pop_head_close_btn",function(o){o.preventDefault(),$.stats.track("\u6587\u5B57\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".locality_pop_window_pic_close_btn",function(o){o.preventDefault(),$.stats.track("\u56FE\u7247\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".j_local_pic_pop_window",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_img",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_title",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".local_pop_window_content",function(){$.stats.track("frs"==o?73:75,t.taskName,a,"click",{popWindowType:e,taskName:t.taskName,tbjump:t.link,obj_id:t.adId})})},runStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);if(!o||0>o)this.resetStrategy(t),this.stepStrategy(t);else{if(0==o)return;this.stepStrategy(t)}this.showPop(t)},resetStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,1)},stepStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);$.cookie("locality_pop_window_"+t.adId,++o)},clearStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,0)},showPop:function(){var t=this,o=setTimeout(function(){t.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(o),o=null},2e3)},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})}}});_.Module.define({path:"pplatform/widget/PlatformSpreadLayer",requires:["pcommon/widget/pb_track"],sub:{initial:function(t,a,o,e){if(this.$platformLayer=$("#platform_left_float"),this.$platformCloseBtn=$("#j_platform_close_btn"),this.$platformClickBtn=$("#j_platform_float_content"),this.shouldShowLayer=$.tb.Storage.get("platform_float_hide_"+t)?!0:!1,this.opt=t,this.isLocality=a,this.evl=o,this.evlPb=e,this.shouldShowLayer=a?$.cookie("locality_float_hide_"+t)?!0:!1:$.cookie("platform_float_hide_"+t)?!0:!1,!this.shouldShowLayer){this.isLocality?$.stats.track("\u5730\u65B9\u5427","\u8D34\u5427\u6D6E\u6807",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:t}):$.stats.track("\u6574\u4F53","\u8D34\u5427\u6D6E\u6807",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:t}),this.$platformLayer.show(),this._bindEvent(),"pb"===PageData.product&&(this.evl.first_dir=PageData.forum.level_1_name,this.evl.second_dir=PageData.forum.level_2_name,this.evlPb.first_dir=PageData.forum.level_1_name,this.evlPb.second_dir=PageData.forum.level_2_name),$.stats.track("p0251","ad_plat",PageData.product,"VIEW_TRUE",this.evl);var i=this.requireInstance("pcommon/widget/pb_track");i._track("p0251","ad_plat",PageData.product,"VIEW_TRUE",this.evlPb)}},_bindEvent:function(){var t=this,a=t.$platformLayer,o=t.$platformCloseBtn,e=t.$platformClickBtn,i=t.opt;e.on("click",function(){$.stats.track("\u6574\u4F53\u70B9\u51FB","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i})}),o.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i}),a.hide(),t.isLocality?$.cookie("locality_float_hide_"+i,1,{path:"/"}):$.cookie("platform_float_hide_"+i,1,{expires:999,path:"/"}),$.tb.Storage.set("platform_float_hide_"+i,1),!1})}}});_.Module.define({path:"pplatform/widget/PlatformSpreadVideo",requires:[],sub:{ANIMATE_STYLE:{UP:1,DOWN:2},videoHeight:255,ch:document.documentElement.clientHeight||document.body.clientHeight,cw:document.documentElement.clientWidth||document.body.clientWidth,initial:function(t,e){var o=$.tb.Storage.get("platform_spread_video_"+e),i=$.tb.Storage.get("platform_video_spread_close_"+e),a=$.tb.Storage.get("platform_video_spread_autoShow_"+e),n=null!=i,d=null==o&&!parseInt(o),s=$.browser.msie&&6==Number($.browser.version);return this.swfURL=t,this.opt=e,this.$videoWrap=$("#platform_spread_video"),this.$videoTopHeads=this.$videoWrap.find(".platform_video_head"),this.$videoContent=this.$videoWrap.find(".platform_video_content"),this.$upHead=this.$videoTopHeads.eq(0),this.$downHead=this.$videoTopHeads.eq(1),this.$downBtn=this.$upHead.find(".head_down_btn"),this.$upBtn=this.$downHead.find(".head_up_btn"),this.$closeBtns=this.$videoTopHeads.find(".head_close_btn"),this.shouldShowVideo=d,s||n?(this.$videoWrap.hide(),void 0):($.stats.track("\u6574\u4F53","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:e}),d&&null==a?($.cookie("platform_video_spread_autoShow_"+e,1,{expires:999,path:"/"}),this._animateTo(this.ANIMATE_STYLE.UP)):this._animateTo(this.ANIMATE_STYLE.DOWN),this._bindEvent(),void 0)},_animateTo:function(t){var e=this,o=e.$videoWrap,i=e.$videoContent,a=e.$downHead,n=e.$upHead,d=e.opt;t&e.ANIMATE_STYLE.UP?($.stats.track("\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d}),i.show(),o.animate({bottom:0},600,function(){a.hide(),n.show(),setTimeout(function(){$.stats.track("\u6709\u6548\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d})},5e3)}),e._loadSwf()):o.animate({bottom:-1*e.videoHeight},600,function(){i.hide(),n.hide(),a.show()})},_bindEvent:function(){var t=this,e=t.$videoWrap,o=t.$closeBtns,i=t.$upBtn,a=t.$downBtn,n=t.opt;o.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),$.tb.Storage.set("platform_video_spread_close_"+n,1),e.hide(),!1}),i.on("click",function(){return t._animateTo(t.ANIMATE_STYLE.UP),!1}),a.on("click",function(){return $.stats.track("\u6536\u8D77\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),t._animateTo(t.ANIMATE_STYLE.DOWN),!1}),a.one("click",function(){return $.tb.Storage.set("platform_video_spread_"+n,1),!1})},_loadSwf:function(){{var t=this,e=t.swfURL,o=t.opt;t.$videoContent}new $.swf(e,{id:"platform_video_spread_"+o,container:"#j_platform_video_content",width:340,height:255})}}});var PopWidowHandle=function(t){var o={url:{P_GET:"/app/pop/bws/popup",P_POST:"/app/pop/commit/click"},delay:15,from_forum:"",page:""};this._option=$.extend(!0,o,t),this._init()};PopWidowHandle.prototype={constructor:PopWidowHandle,_init:function(){var t=this;$(document).ready(function(){setTimeout(function(){t._getPopWindow()},1e3*t._option.delay)})},_getPopWindow:function(){var t=this._option,o=this;$.tb.get(t.url.P_GET,{from_forum:t.from_forum,position:t.page},function(t){0==t.no&&t.data.task_id&&o._showPopWindow(t.data)})},_showPopWindow:function(t){this.data=t;var o=this._option,n={styleId:t.style_id,templateObj:{title:t.title,content:t.content,button:t.button,note:t.note,link:t.link}};this.popWindow=new PopWindow(n);var i=this.popWindow;i.bind("closeSuccess",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:1,count:t.count},function(){})},!0),i.bind("clickBtn",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:2,count:t.count},function(){})},!0),i.showPop()}};_.Module.define({path:"pfrs/widget/frs_stamp_notice",sub:{initial:function(){var a=PageData.forum.id,t=$.cookie("fudai_"+a),i=$.cookie("bless_post_"+a),s=PageData.userfortune;s&&1==s.has_fortune_bag&&!t&&1==i&&PageData.userfortune.data_fortune_bag.first_post&&this.showPrintDialog()},showPrintDialog:function(){$.stats.track("stamp_flower_postor","fudai","frs/pb","click");var a=this,t=PageData.forum.id;$.cookie("bless_post_"+t,2,1);var i='<div class="content_1">\u606D\u559C\u4F60\u8FBE\u6210<span class="notice_color">\u672C\u5427\u4ECA\u65E5\u9996\u6B21\u53D1\u8D34\u4EFB\u52A1</span>\uFF0C\u83B7\u5F97<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><span class="notice_color">+'+PageData.userfortune.data_fortune_bag.first_post+"</span>\u5956\u52B1</div>",s='<p class="notice_app">\u540C\u65F6\u5982\u679C\u901A\u8FC7\u5BA2\u6237\u7AEF\u56DE\u8D34\uFF0C\u53EF\u4EE5\u989D\u5916\u83B7\u5F97\u5956\u52B1\u54E6\uFF01</p>',o='<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><a class="j_print_flower print_flower" href="http://tieba.baidu.com/p/2916765309" target="_blank">\u5370\u82B1\u662F\u4EC0\u4E48\uFF1F</a>',e='<div class="print_button"><a href="#" class="ui_btn ui_btn_m j_print_ok"><span><em>\u597D \u7684</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_tips j_print_no"><span><em>\u4E0D\u518D\u63D0\u793A</em></span></a></div>',n='<div class="frs_stamp_notice">'+i+s+o+e+"</div>",r=$.dialog.open(n,{width:428,noTitle:!0,modal:!1});$(".j_print_ok").click(function(a){a.preventDefault(),r.close()}),$(".j_print_no").click(function(a){a.preventDefault(),r.close(),$.cookie("fudai_"+t,!0,365)}),$(".j_print_flower").click(function(){a.trackFlower()})},trackFlower:function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")}}});_.Module.define({path:"padsense/widget/Comtrial",sub:{initial:function(a){this.dataObj=a,this._initAD(),this._initPbFlashAd()},_initAD:function(){var a=this,e=a.dataObj,t=802;if($("#search_fengchao")[0]&&$("#search_fengchao_left")[0]&&"search"==e.page&&0==e.hide_searchad){window.arrBaiduAds=window.arrBaiduAds||{};var i="http://a.baidu.com/ecom?di=802,779&tm=baiduASPT802S,baiduASPT779S&tn=SE_ecomt01_b7az25cz,SE_ecomt01_b7az25cz&word="+e.query_encode+"&eid="+t;$.JsLoadManager.use([i],function(){$("#search_fengchao").html(window.arrBaiduAds[779]),$("#search_fengchao_left").html(window.arrBaiduAds[802])})}$.JsLoadManager.use(["http://cbjs.baidu.com/js/m.js"],function(){var e=a.dataObj,t=PageData.forum?PageData.forum.forum_id:0;window.BAIDU_DAN_config={zIndex:1},$("#search_union_mod")[0]&&"search"==e.page&&0==e.hide_searchad&&(a._loadWm({width:250,height:250,tpl:"pb",page:"pb",id:696315,forumId:t,selector:"#search_union_mod"}),$("#search_union_mod").show())}),$("#search_bottomad")[0]&&"search"==e.page&&0==e.hide_searchad&&($("#search_bottomad").html($.tb.format($("#comtrial_search_bottomad").html(),null)),$("#search_bottomad").show())},_loadWm:function(a){if(null!=a&&a){var e=a.src||"http://tieba.baidu.com/tb/zt/spread/pcwm.html?",t=a.id,i=a.forumId,d=a.tpl||"pb",o=a.page||"pb";e+="tpl="+d+"&page="+o+"&id="+t+"&forumId="+i;var r=a.selector,h=a.width,n=a.height,s=$('<iframe src="'+e+'" style="width:'+h+"px;height:"+n+'px" scrolling="no" frameborder="0"></iframe>');$(r).html(s)}},_initPbFlashAd:function(){var a=PageUnit.load("tope_pbbanner_swf");a&&new $.swf(a,{id:"chart",container:"#banner_pb_customize",width:960,height:90,params:{wmode:"transparent"}})}}});_.Module.define({path:"ppb/widget/UrlCheck",sub:{url:"/f/urlcheck",urlToBeChecked:"",b_option:{content:"",arrowReq:!1,closeBtn:!1},initial:function(){this._bindEvent()},_bindEvent:function(){var e=this;$("#j_p_postlist").on({mouseenter:function(){var t=$(this),n=t.parents("div.l_post"),a=n.getData(),l=a.content.id;t.data("handler",null);var o=null,i=!0;if(t.data("level")){var u=setTimeout(function(){e._show(t)},25);t.data("handler",u)}else{e.urlToBeChecked=t.tbattr("href");var r={urls:[t.tbattr("href")],ie:"utf8",post_id:l},c=function(){$.tb.get(e.url,r,function(n){if(-1!=n.no){var a=15;0==n.no&&n.data&&n.data.url_info&&(a=n.data.url_info[0].whitetype||15),t.data("level",a),i&&(o=setTimeout(function(){e._show(t)},25))}})};c()}t.on("mouseleave",function(){i=!1,clearTimeout(o),clearTimeout(t.data("handler")),u=setTimeout(function(){e._hide(t)},25),t.data("handler",u)})},click:function(e){{var t=$(this),n=t.data("level");t.tbattr("href")}11!=n&&12!=n&&15!=n&&void 0!=n&&e.preventDefault()}},".j_d_post_content a:not(.at), .j_lzl_s_p .lzl_content_main a:not(.at)")},_show:function(e){var t=this;if(!e.data("bubble")){var n,a,l=e.data("level"),o=e.tbattr("href"),i=e.text(),u=e.position();switch(l){case 11:case 12:return;case 13:n="unsecure",a="\u53EF\u4FE1\u5EA6\u4F4E\uFF0C\u4E0D\u5EFA\u8BAE\u8BBF\u95EE";break;case 14:n="danger",a="\u5371\u9669\u7F51\u7AD9\uFF0C\u5343\u4E07\u522B\u8BBF\u95EE";break;case 15:default:return}t._sendStats("bbshow");var r=['<a href="http://guanjia.qq.com"  class="icon_link" target="_blank" >&nbsp;</a>','<div class="url_check_bubble_wrap '+n+'">','<p class="text">'+a+"</p>",'<p class="control"><a href="http://guanjia.qq.com/online_server/complain_url.html?url='+encodeURIComponent(i)+'" class="j_argue_url" target="_blank">\u7533\u8BC9</a> <a href="'+o+'" class="open_url j_open_url" target="_blank">\u6253\u5F00</a>',"</div>"].join(""),c=$.extend({},this.b_option);c.content=r,c.wrap=e.parents(".p_content");var s=u.top-55-e.height();c.bubble_css={left:u.left,top:s,width:258,height:72};var b={zIndex:$.getcurzIndex()},_=new UiBubbleTipBase(c);_.showBubble(b),_.j_bubble.addClass("url_check_bubble_container"),_.j_bubble.on({mouseenter:function(){_.j_bubble.find("a.j_argue_url");clearTimeout(e.data("handler"))},mouseleave:function(){hdl=setTimeout(function(){t._hide(e)},25),e.data("handler",hdl)}}),_.j_bubble.find("a.icon_link").on({click:function(){t._sendStats("iconclick")}}),_.j_bubble.find("a.j_argue_url").on({click:function(){t._sendStats("argueclick")}}),_.j_bubble.find("a.j_open_url").on({click:function(){t._sendStats("openclick")}}),e.data("bubble",_)}},_sendStats:function(e){var t=this;$.stats.sendRequest("bubble=urlcheck&page=pb&function="+e+"&url="+t.urlToBeChecked)},_hide:function(e){var t=e.data("bubble");t&&(t.closeBubble(),e.removeData("bubble"))}}});_.Module.define({path:"puser/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){{var i=this,e="1070002"==this.propsId?"egg":"worship",s="/tb/static-puser/swf/guide_"+e+".swf?t=140112";new $.swf(s,{container:i.$guideContent,width:980,height:600,params:{wmode:"transparent"}})}this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});_.Module.define({path:"puser/widget/MagicProps",requires:["puser/widget/Residual","puser/component/Guide"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"\u9B54\u62DC",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"\u9B54\u86CB",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("puser/widget/Residual"),this.guide=this.use("puser/component/Guide")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},i=null,a=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)a=o[r],i={id:a,count:t[a]&&t[a].left_num||0},$.extend(i,this.propsOptions[a]),s.push(i),e[a]=i;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,i=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),a=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],a.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?a.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="/tb/static-puser/img/props/'+s.key+'.png"/></a>'):a.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="/tb/static-puser/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),a.push('<p class="props_item_title">'),a.push("<span>"+s.name+"</span>"),s.count>0&&(a.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),a.push('<span class="props_item_num">'+s.count+"</span>")),a.push("</p>"),a.push("</li>");i.html(a.join("")),i.hide().appendTo(t.$wrap),t.$propsList=i},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn(),t.guide.initMagicGuide()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var i=$(this).data("id"),a=t.propsMap[i];return t.propsObj=a,a.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},i=$("#headinfo_wrap"),a=i.offset().left,s=i.offset().top,e=a+i.width(),o={marginLeft:a,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),i=t.find(".l_post"),a=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<i.length;n++)a=$(i[n]),s=a.getData(),this.doPostItem(a,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,i,a,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:i.author.user_id,postId:i.content.post_id,propsData:i.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=a+130,r.marginLeft=a,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=a+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),i=$('<div class="mask_layer mask_right"></div>'),a=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(i).append(a).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:i,bottomMask:a,leftMask:s,lightArea:e}},setMaskPosition:function(t,i,a,s){var e=this.maskMap;e.topMask.css({height:i}),e.rightMask.css({left:t+a,top:i,width:$("body").width()-(t+a),height:s}),e.bottomMask.css({top:i+s,height:$("body").height()-(i+s)}),e.leftMask.css({top:i,width:t,height:s}),e.lightArea.css({left:t,top:i,width:a,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(i){if(27==i.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(i){if(3==i.which){if(t.disabledMove)return!1;t.clear()}return!1});var i=50,a=$("body").width()-i,s=0;t.$maskWrap.mousemove(function(i){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=i.pageX,s>a&&(s=a),t.$bulletLayer.css({left:s,top:i.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=i.pageX>=o.marginLeft&&i.pageX<=o.marginRight&&i.pageY>=o.marginTop&&i.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],i.pageX>=e.marginLeft&&i.pageX<=e.marginRight&&i.pageY>=e.marginTop&&i.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,i=$('<div class="bullet_layer"><span class="bullet_layer_tip">\u53F3\u952E\u53D6\u6D88</span></div>');return i.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),i},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,i="/tbmall/post/useAppraiseProps",a={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(i,a,function(i){i&&0==i.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,i=".props_item_"+t;this.updatePropsBtnNum(t,i),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,i)},updatePropsBtnNum:function(t,i){var a=$("#tbui_aside_props_list "+i),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?a.find(".props_item_num").text(s):(a.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),a.find(".props_item_sign").remove(),a.find(".props_item_num").remove())},updatePostAreaNum:function(t,i){var a=this.areaObj.propsData||{};a[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(i);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,i=this.propsOptions[this.propsObj.id].flashOptions,a=($(window).height()-i.height)/2;a=150>a?150:a;var s=this.areaObj.jdom.offset().top-a;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var i=this,a=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==i.areaObj.propsType&&"1070002"==i.propsObj.id&&("ihome"==PageData.product?(a=100,s=-15):(a=60,s=-20),r=r-(r+o.marginLeft-i.areaObj.jdom.offset().left)+a,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-puser/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}i.flashPool.push(e),i.$maskWrap.append(e),i.topzIndex=$.getzIndex(),i.$bulletLayer.css({"z-index":i.topzIndex})},buildPlusOne:function(){var t=this,i="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(i+="_png8"),i="/tb/static-puser/img/"+i+".png";var a=$('<div class="props_plusone"><img src="'+i+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),a.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(a),a.animate({top:"-=100px",opacity:.8},800,"swing",function(){a.remove()})},clearPool:function(){for(var t=this,i=t.flashPool,a=null,s=0;s<i.length;s++)a=i.shift(),a.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,i={},a=null;i.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var i=t.flashPool.shift();i.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?a=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(a=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:a,key:t.propsObj.key})))}},window.MagicProps=i},showTomallDialog:function(){var t=this,i=new $.dialog({title:"\u63D0\u793A",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">\u4F60\u76EE\u524D\u6CA1\u6709\u53EF\u7528\u7684\u9053\u5177\u4E86\uFF0C\u5FEB\u53BB\u5546\u57CE\u8D2D\u4E70\u5427</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">\u53BB\u8D2D\u4E70>></a><div>',width:400,height:80});i.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var i='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',a=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(i,{href:$.tb.unescapeHTML(t)}),width:400,height:80});a.bind("onclose",function(){$.tb.location.reload()}),a.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});_.Module.define({path:"puser/widget/Feedback",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions(),this.initCallbacks(),this.initData(),this.play()},initOptions:function(){this.options={1070001:{id:"1070001",key:"worship",name:"\u819C\u62DC",flashOptions:{width:250,height:220,marginLeft:120,marginTop:95}},1070002:{id:"1070002",key:"egg",name:"\u81ED\u9E21\u86CB",flashOptions:{width:410,height:260,marginLeft:195,marginTop:30}}}},initData:function(){for(var i=this.dataObj.appraise||{},t=null,e=null,a=[],n=["1070001","1070002"],s=0;s<n.length;s++)t=i[n[s]],t&&t.notice>0&&(e=this.options[n[s]],$.extend(e,t),a.push(e));this.playList=a},play:function(){var i=this.playList;i.length>0&&(i.sort(function(i,t){return t.notice!=i.notice?t.notice-i.notice:parseInt(t.id)-parseInt(i.id)}),this.index=0,this.buildFlash(),this.clearNotice())},buildFlash:function(){if(this.index<this.playList.length){var i=$('<div class="props_flash_wrap"></div>');$("body").append(i);var t=this.playList[this.index],e=this.getFlashData(t);i.css({width:e.width,height:e.height,left:e.marginLeft,top:e.marginTop,"z-index":e.zindex});{var a="/tb/static-puser/swf/"+e.feedbackName+"?t=0101";new $.swf(a,{id:"props_flash_content",name:"props_flash_content",container:i,width:e.width,height:e.height,params:{wmode:"transparent"}})}t.wrap=i}},getFlashData:function(i){var t=i.flashOptions,e=0,a=0,n=0,s=0,o=PageData.product;switch(o){case"pb":case"frs":case"index":n=40,e=$("#user_info").offset().left,a=$("#user_info").offset().top;break;case"ihome":n=92,e=$("#userinfo_wrap").offset().left,a=$("#userinfo_wrap").offset().top}e=e-t.marginLeft+n,a=a-t.marginTop+s;var h=i.notice>1?"more":"single";return feedbackName="feedback_"+i.key+"_"+h+".swf",{key:i.key,feedbackName:feedbackName,width:t.width,height:t.height,marginLeft:e,marginTop:a,zindex:$.getzIndex()}},clearNotice:function(){var i="/tbmall/post/clearAppraiseNotice",t={type:0,tbs:PageData.tbs};$.tb.post(i,t,function(i){i&&0==i.no})},initCallbacks:function(){var i=this,t={};t.finishPlay=function(){i.playList[i.index].wrap.remove(),i.index++,i.buildFlash()},window.MagicProps=t}}});_.Module.define({path:"ppb/widget/PbTrack",sub:{initial:function(){var n=this;$(".j_benba_search").click(function(){n._sendTrack("\u5427\u5185\u641C\u7D22\u70B9\u51FB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".j_search_post").click(function(){n._sendTrack("\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".share_thread").mouseover(function(){n._sendTrack("PB\u4E00\u697C\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".p_sharebar").mouseover(function(){n._sendTrack("PB\u5E95\u90E8\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")});var c=setInterval(function(){$(".tbui_fbar_share").length&&($(".tbui_fbar_share").mouseover(function(){n._sendTrack("PB\u5DE6\u4FA7\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),clearInterval(c))},200);$("#tofrs_up").click(function(){n._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u9996","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$("#tofrs_down").click(function(){n._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u5C3E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".tab_forumname").click(function(){n._sendTrack("PB\u9875\u8FD4\u56DEFRS\u4E3B\u9875\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")});var e=setInterval(function(){$(".j_lzl_p_sv").length&&($(".j_lzl_p_sv").click(function(){n._sendTrack("\u697C\u4E2D\u697C\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),clearInterval(e))},200),t=setInterval(function(){$(".edui-btn-voice").length&&($(".edui-btn-voice").click(function(){n._sendTrack("\u56DE\u590D\u6846\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),clearInterval(t))},200);$(".v2_tab a").eq(3).click(function(){n._sendTrack("PB\u9875\u7CBE\u54C1\u6807\u7B7E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".sign_title_text_bright a").click(function(){n._sendTrack("\u7B7E\u5230\u6846\u4E0A\u4E0B\u7684\u5BA2\u6237\u7AEF\u63A8\u5E7F\u94FE\u63A5","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")})},_sendTrack:function(n,c,e){$.stats.track(n,c,e,"click")}}});_.Module.define({path:"ppb/widget/specialAutoFocus",sub:{config:{url:{dolike:"/f/like/commit/add"}},initial:function(){var i=$.getPageData("user.user_id");this.userId=i,this.tbs=$.getPageData("tbs"),i&&this.doLike()},doLike:function(){var i=this,e={fid:"805227",fname:"galaxy",uid:i.userId,ie:"gbk",tbs:i.tbs};$.post(i.config.url.dolike,e,function(i){i&&0==i.no&&$("#j_head_focus_btn").removeClass("islike_focus").addClass("cancel_focus")},"json")}}});